<!DOCTYPE html>
<!-- saved from url=(0089)http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html -->
<html lang="zh-cn"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script async="" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/analytics.js.下载"></script>

<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园</title>
<link type="text/css" rel="stylesheet" href="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/blog-common.css">
<link id="MainCss" type="text/css" rel="stylesheet" href="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/bundle-LessIsMoreRight.css">
<link type="text/css" rel="stylesheet" href="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/88841.css">
<link id="mobile-style" media="only screen and (max-width: 768px)" type="text/css" rel="stylesheet" href="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/bundle-LessIsMoreRight-mobile.css">
<link title="RSS" type="application/rss+xml" rel="alternate" href="http://www.cnblogs.com/OceanEyes/rss">
<link title="RSD" type="application/rsd+xml" rel="EditURI" href="http://www.cnblogs.com/OceanEyes/rsd.xml">
<link type="application/wlwmanifest+xml" rel="wlwmanifest" href="http://www.cnblogs.com/OceanEyes/wlwmanifest.xml">
<script src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/jquery.js.下载" type="text/javascript"></script>  
<script type="text/javascript">var currentBlogApp = 'OceanEyes', cb_enable_mathjax=false;var isLogined=false;</script>
<script src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/blog-common.js.下载" type="text/javascript"></script>
</head>
<body><link href="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/jiathis_share.css" rel="stylesheet" type="text/css"><div class="jiathis_style" style="height: auto; position: fixed; z-index: 100000000; top: 150px; right: 0px; overflow: hidden; width: 26px;"><table cellpadding="0" cellspacing="0"><tbody style="background:transparent"><tr><td style="background:transparent"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/r.gif" style="cursor:pointer;" onmouseover="$CKE.over()" onclick="$CKE.center(this)"></td><td><div><div class="jiadiv_01"><div style="width:100%;background:#F2F2F2;border-bottom:1px solid #E5E5E5;line-height:200%;padding-left:5px;font-size:12px"><table width="100%"><tbody><tr class="jt_sharetitle"><td align="left" style="text-align:left;line-height:25px;font-size:14px;font-weight:bold;color:#000000;">分享到...</td><td align="right" style="text-align:right;"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/img_exit.gif" border="0" style="opacity:0.5;filter:alpha(opacity=50);margin:0 10px;cursor:pointer;" onclick="$CKE.shareClose();"></td></tr></tbody></table></div><div class="jiadiv_02" style="width:100%;" id="jiathis_sers"><a href="javascript:;" onclick="jiathis_sendto(&#39;weixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_weixin">微信</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsina">微博</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;copy&#39;);return false;" class="jiatitle"><span class="jtico jtico_copy">复制网址</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;email&#39;);return false;" class="jiatitle"><span class="jtico jtico_email">邮件</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_cqq">QQ好友</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_qzone">QQ空间</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renren&#39;);return false;" class="jiatitle"><span class="jtico jtico_renren">人人网</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kaixin001&#39;);return false;" class="jiatitle"><span class="jtico jtico_kaixin001">开心网</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;evernote&#39;);return false;" class="jiatitle"><span class="jtico jtico_evernote">印象笔记</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;linkedin&#39;);return false;" class="jiatitle"><span class="jtico jtico_linkedin">领英</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;feixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_feixin">飞信</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban">豆瓣</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;twitter&#39;);return false;" class="jiatitle"><span class="jtico jtico_twitter">Twitter</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fb&#39;);return false;" class="jiatitle"><span class="jtico jtico_fb">Facebook</span></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ishare&#39;);return false;" class="jiatitle"><span class="jtico jtico_ishare">一键分享</span></a><a href="javascript:;" onclick="$CKE.center(this);return false;" class="jiatitle"><span class="jtico jtico_jiathis">查看更多(96)</span></a><div style="clear:both"></div></div><div class="ckepopBottom" style="width:100%;"><div style="float:left;font-size:10px"><a href="http://www.jiathis.com/help/html/what-is-jiathis" class="link_01" style="color:#333333;display:none;" target="_blank">这是什么工具?</a></div><div style="float:right;font-size:11px;margin:0 5px 0 0;"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/img_012.gif" align="absmiddle" border="0"><a href="http://www.jiathis.com/index2" style="color:#333333;padding:0 3px;" class="link_01" target="_blank">JiaThis</a></div><div style="clear:both"></div></div></div></div></td></tr></tbody></table></div><iframe frameborder="0" style="position: absolute; display: none;" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/saved_resource.html"></iframe><div class="jiathis_style" style="height: auto; position: absolute; z-index: 100000000; display: none; top: 50%; left: 50%; overflow: auto;"><div style="border:10px solid #7F7F7F; width:300px;"><div class="jiadiv_01" style="width:300px;"><div style="background:#F2F2F2;line-height:100%;height:30px;overflow:hidden;width:300px;"><table width="100%" style="margin:5px 0 0 0;"><tbody><tr class="jt_sharetitle" style="line-height:20px!important;"><td align="left" style="text-align:left;font-size:12px;">分享到各大网站</td><td align="right"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/img_exit.gif" border="0" style="margin:0 4px;cursor:pointer;" onclick="$CKE.centerClose();"></td></tr></tbody></table></div><div class="searchTxtCont"><div style="background:url(http://v2.jiathis.com/code/images/img_so.gif) no-repeat center;height:30px; width:281px"><form onsubmit="return false;"><input class="searchTxt" name="" type="text" onclick="this.value=&#39;&#39;;this.style.color=&#39;#000&#39;;" value="输入网站名或拼音缩写" onkeyup="$CKE.choose(this);"></form></div></div><div id="jiathis_sharelist" class="jiadiv_02" style="width:300px;height:300px;overflow-y:auto;"><a href="javascript:;" onclick="jiathis_sendto(&#39;weixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_weixin">微信</span><input type="hidden" value="weixin,微信,wx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tsina&#39;);return false;" class="jiatitle"><span class="jtico jtico_tsina">微博</span><input type="hidden" value="tsina,微博,xlwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_cqq">QQ好友</span><input type="hidden" value="cqq,QQ好友,cqq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_qzone">QQ空间</span><input type="hidden" value="qzone,QQ空间,qqkj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;copy&#39;);return false;" class="jiatitle"><span class="jtico jtico_copy">复制网址</span><input type="hidden" value="copy,复制网址,fzwz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fav&#39;);return false;" class="jiatitle"><span class="jtico jtico_fav">收藏夹</span><input type="hidden" value="fav,收藏夹,scj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;print&#39;);return false;" class="jiatitle"><span class="jtico jtico_print">打印</span><input type="hidden" value="print,打印,dy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;email&#39;);return false;" class="jiatitle"><span class="jtico jtico_email">邮件</span><input type="hidden" value="email,邮件,yj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;renren&#39;);return false;" class="jiatitle"><span class="jtico jtico_renren">人人网</span><input type="hidden" value="renren,人人网,rrw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;kaixin001&#39;);return false;" class="jiatitle"><span class="jtico jtico_kaixin001">开心网</span><input type="hidden" value="kaixin001,开心网,kxw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;evernote&#39;);return false;" class="jiatitle"><span class="jtico jtico_evernote">印象笔记</span><input type="hidden" value="evernote,印象笔记,evernote"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;linkedin&#39;);return false;" class="jiatitle"><span class="jtico jtico_linkedin">领英</span><input type="hidden" value="linkedin,领英,linkedin"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;feixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_feixin">飞信</span><input type="hidden" value="feixin,飞信,fx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban">豆瓣</span><input type="hidden" value="douban,豆瓣,db"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;twitter&#39;);return false;" class="jiatitle"><span class="jtico jtico_twitter">Twitter</span><input type="hidden" value="twitter,Twitter,twitter"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fb&#39;);return false;" class="jiatitle"><span class="jtico jtico_fb">Facebook</span><input type="hidden" value="fb,Facebook,facebook"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ishare&#39;);return false;" class="jiatitle"><span class="jtico jtico_ishare">一键分享</span><input type="hidden" value="ishare,一键分享,yjfx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ujian&#39;);return false;" class="jiatitle"><span class="jtico jtico_ujian">猜你喜欢</span><input type="hidden" value="ujian,猜你喜欢,cnxh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;yixin&#39;);return false;" class="jiatitle"><span class="jtico jtico_yixin">易信</span><input type="hidden" value="yixin,易信,yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;huaban&#39;);return false;" class="jiatitle"><span class="jtico jtico_huaban">花瓣网</span><input type="hidden" value="huaban,花瓣网,hbw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tqq&#39;);return false;" class="jiatitle"><span class="jtico jtico_tqq">腾讯微博</span><input type="hidden" value="tqq,腾讯微博,txwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;googleplus&#39;);return false;" class="jiatitle"><span class="jtico jtico_googleplus">Google+</span><input type="hidden" value="googleplus,Google+,googlej"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;alibaba&#39;);return false;" class="jiatitle"><span class="jtico jtico_alibaba">阿里巴巴</span><input type="hidden" value="alibaba,阿里巴巴,albb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;xiaoyou&#39;);return false;" class="jiatitle"><span class="jtico jtico_xiaoyou">朋友网</span><input type="hidden" value="xiaoyou,朋友网,pyw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;sdonote&#39;);return false;" class="jiatitle"><span class="jtico jtico_sdonote">麦库记事</span><input type="hidden" value="sdonote,麦库记事,mkjs"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;baidu&#39;);return false;" class="jiatitle"><span class="jtico jtico_baidu">百度搜藏</span><input type="hidden" value="baidu,百度搜藏,bdsc"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;gmail&#39;);return false;" class="jiatitle"><span class="jtico jtico_gmail">Gmail邮箱</span><input type="hidden" value="gmail,Gmail邮箱,gmailyx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ydnote&#39;);return false;" class="jiatitle"><span class="jtico jtico_ydnote">有道云笔记</span><input type="hidden" value="ydnote,有道云笔记,ydybj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tianya&#39;);return false;" class="jiatitle"><span class="jtico jtico_tianya">天涯社区</span><input type="hidden" value="tianya,天涯社区,tysq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tieba&#39;);return false;" class="jiatitle"><span class="jtico jtico_tieba">百度贴吧</span><input type="hidden" value="tieba,百度贴吧,bdtb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qingbiji&#39;);return false;" class="jiatitle"><span class="jtico jtico_qingbiji">轻笔记</span><input type="hidden" value="qingbiji,轻笔记,qbj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tifeng&#39;);return false;" class="jiatitle"><span class="jtico jtico_tifeng">凤凰微博</span><input type="hidden" value="tifeng,凤凰微博,fhwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;fanfou&#39;);return false;" class="jiatitle"><span class="jtico jtico_fanfou">饭否</span><input type="hidden" value="fanfou,饭否,ff"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mingdao&#39;);return false;" class="jiatitle"><span class="jtico jtico_mingdao">明道</span><input type="hidden" value="mingdao,明道,md"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;douban9dian&#39;);return false;" class="jiatitle"><span class="jtico jtico_douban9dian">豆瓣9点</span><input type="hidden" value="douban9dian,豆瓣9点,db9d"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;google&#39;);return false;" class="jiatitle"><span class="jtico jtico_google">谷歌</span><input type="hidden" value="google,谷歌,gg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;buzz&#39;);return false;" class="jiatitle"><span class="jtico jtico_buzz">谷歌Buzz</span><input type="hidden" value="buzz,谷歌Buzz,ggbuzz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;youdao&#39;);return false;" class="jiatitle"><span class="jtico jtico_youdao">有道书签</span><input type="hidden" value="youdao,有道书签,ydsq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;qq&#39;);return false;" class="jiatitle"><span class="jtico jtico_qq">QQ书签</span><input type="hidden" value="qq,QQ书签,qqsq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;msn&#39;);return false;" class="jiatitle"><span class="jtico jtico_msn">MSN</span><input type="hidden" value="msn,MSN,msn"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pinterest&#39;);return false;" class="jiatitle"><span class="jtico jtico_pinterest">Pinterest</span><input type="hidden" value="pinterest,Pinterest,pinterest"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;duitang&#39;);return false;" class="jiatitle"><span class="jtico jtico_duitang">堆糖</span><input type="hidden" value="duitang,堆糖,dt"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tyaolan&#39;);return false;" class="jiatitle"><span class="jtico jtico_tyaolan">摇篮微博</span><input type="hidden" value="tyaolan,摇篮微博,ylwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hi&#39;);return false;" class="jiatitle"><span class="jtico jtico_hi">百度空间</span><input type="hidden" value="hi,百度空间,bdkj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hotmail&#39;);return false;" class="jiatitle"><span class="jtico jtico_hotmail">Hotmail邮箱</span><input type="hidden" value="hotmail,Hotmail邮箱,hotmailyx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;xqw&#39;);return false;" class="jiatitle"><span class="jtico jtico_xqw">雪球</span><input type="hidden" value="xqw,雪球,xqw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;hexun&#39;);return false;" class="jiatitle"><span class="jtico jtico_hexun">和讯</span><input type="hidden" value="hexun,和讯,hx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;139mail&#39;);return false;" class="jiatitle"><span class="jtico jtico_139mail">139邮箱</span><input type="hidden" value="139mail,139邮箱,139yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189mail&#39;);return false;" class="jiatitle"><span class="jtico jtico_189mail">189邮箱</span><input type="hidden" value="189mail,189邮箱,189yx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;189cn&#39;);return false;" class="jiatitle"><span class="jtico jtico_189cn">翼友圈</span><input type="hidden" value="189cn,翼友圈,yyq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tpeople&#39;);return false;" class="jiatitle"><span class="jtico jtico_tpeople">人民微博</span><input type="hidden" value="tpeople,人民微博,rmwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;txinhua&#39;);return false;" class="jiatitle"><span class="jtico jtico_txinhua">新华微博</span><input type="hidden" value="txinhua,新华微博,xhwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;translate&#39;);return false;" class="jiatitle"><span class="jtico jtico_translate">谷歌翻译</span><input type="hidden" value="translate,谷歌翻译,ggfy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tuita&#39;);return false;" class="jiatitle"><span class="jtico jtico_tuita">推他</span><input type="hidden" value="tuita,推他,tt"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mop&#39;);return false;" class="jiatitle"><span class="jtico jtico_mop">猫扑推客</span><input type="hidden" value="mop,猫扑推客,mptk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;meilishuo&#39;);return false;" class="jiatitle"><span class="jtico jtico_meilishuo">美丽说</span><input type="hidden" value="meilishuo,美丽说,mls"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mogujie&#39;);return false;" class="jiatitle"><span class="jtico jtico_mogujie">蘑菇街</span><input type="hidden" value="mogujie,蘑菇街,mgj"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;ganniu&#39;);return false;" class="jiatitle"><span class="jtico jtico_ganniu">赶牛网</span><input type="hidden" value="ganniu,赶牛网,gnw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;poco&#39;);return false;" class="jiatitle"><span class="jtico jtico_poco">Poco网</span><input type="hidden" value="poco,Poco网,pocow"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;leihou&#39;);return false;" class="jiatitle"><span class="jtico jtico_leihou">雷猴网</span><input type="hidden" value="leihou,雷猴网,lhw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;thexun&#39;);return false;" class="jiatitle"><span class="jtico jtico_thexun">和讯微博</span><input type="hidden" value="thexun,和讯微博,hxwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;dream163&#39;);return false;" class="jiatitle"><span class="jtico jtico_dream163">游戏江湖</span><input type="hidden" value="dream163,游戏江湖,yxjh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;jcrb&#39;);return false;" class="jiatitle"><span class="jtico jtico_jcrb">法律微博</span><input type="hidden" value="jcrb,法律微博,flwb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;tumblr&#39;);return false;" class="jiatitle"><span class="jtico jtico_tumblr">Tumblr</span><input type="hidden" value="tumblr,Tumblr,tumblr"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;reddit&#39;);return false;" class="jiatitle"><span class="jtico jtico_reddit">Reddit</span><input type="hidden" value="reddit,Reddit,reddit"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;instapaper&#39;);return false;" class="jiatitle"><span class="jtico jtico_instapaper">Instapaper</span><input type="hidden" value="instapaper,Instapaper,instapaper"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pocket&#39;);return false;" class="jiatitle"><span class="jtico jtico_pocket">Pocket</span><input type="hidden" value="pocket,Pocket,pocket"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;caimi&#39;);return false;" class="jiatitle"><span class="jtico jtico_caimi">财迷</span><input type="hidden" value="caimi,财迷,cm"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;iwo&#39;);return false;" class="jiatitle"><span class="jtico jtico_iwo">WO+分享</span><input type="hidden" value="iwo,WO+分享,iwo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;waakee&#39;);return false;" class="jiatitle"><span class="jtico jtico_waakee">挖客网</span><input type="hidden" value="waakee,挖客网,wkw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;cyzone&#39;);return false;" class="jiatitle"><span class="jtico jtico_cyzone">创业邦</span><input type="hidden" value="cyzone,创业邦,cyb"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;99earth&#39;);return false;" class="jiatitle"><span class="jtico jtico_99earth">救救地球</span><input type="hidden" value="99earth,救救地球,jjdq"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;chouti&#39;);return false;" class="jiatitle"><span class="jtico jtico_chouti">抽屉网</span><input type="hidden" value="chouti,抽屉网,ctw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;dig24&#39;);return false;" class="jiatitle"><span class="jtico jtico_dig24">递客网</span><input type="hidden" value="dig24,递客网,dkw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;yijee&#39;);return false;" class="jiatitle"><span class="jtico jtico_yijee">易集网</span><input type="hidden" value="yijee,易集网,yjw"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pdfonline&#39;);return false;" class="jiatitle"><span class="jtico jtico_pdfonline">Pdf在线转换</span><input type="hidden" value="pdfonline,Pdf在线转换,pdfzxzh"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;printfriendly&#39;);return false;" class="jiatitle"><span class="jtico jtico_printfriendly">友好打印</span><input type="hidden" value="printfriendly,友好打印,yhdy"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;w3c&#39;);return false;" class="jiatitle"><span class="jtico jtico_w3c">W3c验证</span><input type="hidden" value="w3c,W3c验证,w3cyz"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;bitly&#39;);return false;" class="jiatitle"><span class="jtico jtico_bitly">Bit.ly</span><input type="hidden" value="bitly,Bit.ly,bitly"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;digg&#39;);return false;" class="jiatitle"><span class="jtico jtico_digg">Digg</span><input type="hidden" value="digg,Digg,digg"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mailru&#39;);return false;" class="jiatitle"><span class="jtico jtico_mailru">Mail.ru</span><input type="hidden" value="mailru,Mail.ru,mail.ru"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;diigo&#39;);return false;" class="jiatitle"><span class="jtico jtico_diigo">Diigo</span><input type="hidden" value="diigo,Diigo,diigo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;friendfeed&#39;);return false;" class="jiatitle"><span class="jtico jtico_friendfeed">FriendFeed</span><input type="hidden" value="friendfeed,FriendFeed,friendfeed"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;myspace&#39;);return false;" class="jiatitle"><span class="jtico jtico_myspace">Myspace</span><input type="hidden" value="myspace,Myspace,myspace"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;mixx&#39;);return false;" class="jiatitle"><span class="jtico jtico_mixx">Mixx</span><input type="hidden" value="mixx,Mixx,mixx"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;netlog&#39;);return false;" class="jiatitle"><span class="jtico jtico_netlog">NetLog</span><input type="hidden" value="netlog,NetLog,netlog"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;netvibes&#39;);return false;" class="jiatitle"><span class="jtico jtico_netvibes">Netvibes</span><input type="hidden" value="netvibes,Netvibes,netvibes"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;phonefavs&#39;);return false;" class="jiatitle"><span class="jtico jtico_phonefavs">Phonefavs</span><input type="hidden" value="phonefavs,Phonefavs,phonefavs"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;pingfm&#39;);return false;" class="jiatitle"><span class="jtico jtico_pingfm">Ping.fm</span><input type="hidden" value="pingfm,Ping.fm,ping.fm"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;plaxo&#39;);return false;" class="jiatitle"><span class="jtico jtico_plaxo">Plaxo</span><input type="hidden" value="plaxo,Plaxo,plaxo"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;delicious&#39;);return false;" class="jiatitle"><span class="jtico jtico_delicious">Delicious</span><input type="hidden" value="delicious,Delicious,delicious"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;wong&#39;);return false;" class="jiatitle"><span class="jtico jtico_wong">Mister Wong</span><input type="hidden" value="wong,Mister Wong,misterwong"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;stumbleupon&#39;);return false;" class="jiatitle"><span class="jtico jtico_stumbleupon">Stumbleupon</span><input type="hidden" value="stumbleupon,Stumbleupon,stumbleupon"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;plurk&#39;);return false;" class="jiatitle"><span class="jtico jtico_plurk">Plurk</span><input type="hidden" value="plurk,Plurk,plurk"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;funp&#39;);return false;" class="jiatitle"><span class="jtico jtico_funp">Funp</span><input type="hidden" value="funp,Funp,funp"></a><a href="javascript:;" onclick="jiathis_sendto(&#39;myshare&#39;);return false;" class="jiatitle"><span class="jtico jtico_myshare">Myshare</span><input type="hidden" value="myshare,Myshare,myshare"></a><div style="clear:both"></div></div><div class="centerBottom"><div style="float:left;font-size:10px;"><a href="http://www.jiathis.com/help/html/what-is-jiathis" class="link_01" style="color:#333333;display:none;" target="_blank">这是什么工具?</a></div><div style="float:right;font-size:11px;margin:0 10px 0 0;"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/img_012.gif" align="absmiddle" border="none">&nbsp;<a href="http://www.jiathis.com/index2" style="color:#333333;" class="link_01" target="_blank">JiaThis</a></div><div style="clear:both"></div></div></div></div></div><iframe frameborder="0" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/jiathis_utility.html" style="display: none;"></iframe>
<a name="top"></a>
<!--PageBeginHtml Block Begin-->
<a href="https://github.com/MEyes"><img style="position: absolute; top: 0; right: 0; border: 0;" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
<!--PageBeginHtml Block End-->

<div id="home">
<div id="header">
	<div id="blogTitle">
		
<!--done-->
<div class="title"><a id="Header1_HeaderTitle" class="headermaintitle" href="http://www.cnblogs.com/OceanEyes/"><b style="color:#2B6695;margin-left:30px">大鹏一日同风起，扶摇直上九万里</b></a></div>
<div class="subtitle"><div style="float:left;margin-left:11px;">
<img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/o_apple-touch-icon.png" height="89px">
</div></div>



		
	</div><!--end: blogTitle 博客的标题和副标题 -->
	<div id="navigator">
		
<ul id="navList">
<li id="nav_sitehome"><a id="blog_nav_sitehome" class="menu" href="http://www.cnblogs.com/">博客园</a></li>
<li id="nav_myhome"><a id="blog_nav_myhome" class="menu" href="http://www.cnblogs.com/OceanEyes/">首页</a></li>
<li id="nav_newpost"><a id="blog_nav_newpost" class="menu" rel="nofollow" href="https://i.cnblogs.com/EditPosts.aspx?opt=1">新随笔</a></li>
<li id="nav_contact"><a id="blog_nav_contact" class="menu" rel="nofollow" href="https://msg.cnblogs.com/send/%E6%9C%A8%E5%AE%9B%E5%9F%8E%E4%B8%BB">联系</a></li>
<li id="nav_rss"><a id="blog_nav_rss" class="menu" href="http://www.cnblogs.com/OceanEyes/rss">订阅</a>
<!--<a id="blog_nav_rss_image" class="aHeaderXML" href="http://www.cnblogs.com/OceanEyes/rss"><img src="//www.cnblogs.com/images/xml.gif" alt="订阅" /></a>--></li>
<li id="nav_admin"><a id="blog_nav_admin" class="menu" rel="nofollow" href="https://i.cnblogs.com/">管理</a></li>
</ul>

		<div class="blogStats">
			
			<div id="blog_stats">
<!--done-->
随笔-152&nbsp;
文章-0&nbsp;
评论-1321&nbsp;
</div>
			
		</div><!--end: blogStats -->
	</div><!--end: navigator 博客导航栏 -->
</div><!--end: header 头部 -->
<div id="main">
	<div id="mainContent">
	<div class="forFlow">
		
<div id="post_detail">
<!--done-->
<div id="topics">
	<div class="post">
		<h1 class="postTitle">
			<a id="cb_post_title_url" class="postTitle2" href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html">ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a>
		</h1>
		<div class="clear"></div>
		<div class="postBody">
			<div id="cnblogs_post_body"><a name="_labelTop"></a><div id="navCategory"><p style="font-size:18px"><b>阅读目录</b></p><ul><li><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_label0">ASP.NET Identity 前世今生</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_label1">建立 ASP.NET Identity</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_label2">使用ASP.NET Identity</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_label3">ASP.NET Identity 其他API介绍</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_label4">小节</a></li></ul></div><blockquote>
<p><span style="font-size: 15px;">在之前的文章中，我为大家介绍了OWIN和Katana，有了对它们的基本了解后，才能更好的去学习ASP.NET Identity，因为它已经对OWIN 有了良好的集成。</span></p>
<p><span style="font-size: 15px;">在这篇文章中，我主要关注ASP.NET Identity的建立和使用，包括基础类的搭建和用户管理功能的实现——</span></p>
<p><strong><a href="http://myusermanagement.azurewebsites.net/" target="_blank"><span style="font-size: 15px;">点此进行预览</span></a></strong></p>
<p><a href="https://github.com/MEyes/ASP.NET-Identity-User-Management" target="_blank"><strong>点此下载示例代码</strong></a></p>
<p>在后续文章中，我将探索它更高级的用法，比如身份验证并联合ASP.NET MVC 进行授权、使用第三方登录、声明式认证等。</p>
</blockquote>
<div style="text-align: right"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_labelTop">回到顶部</a><a name="_label0"></a></div><h3><span style="font-size: 15px;">ASP.NET Identity 前世今生</span></h3>
<h4><span style="font-size: 15px;">ASP.NET Membership</span></h4>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">在</span><span style="font-family: Times New Roman;">ASP.NET 2.0</span><span style="font-family: 宋体;">时代，</span><span style="font-family: Times New Roman;">ASP.NET Membership</span><span style="font-family: 宋体;">用于用户管理的常见需求。包括表单身份验证（</span><span style="font-family: Times New Roman;">Form Authentication</span><span style="font-family: 宋体;">），一个用于存储用户名、密码和其他用户信息的</span><span style="font-family: Times New Roman;"> SQL Server </span><span style="font-family: 宋体;">数据库。但是现在，对于</span><span style="font-family: Times New Roman;"> Web </span><span style="font-family: 宋体;">应用程序的数据存储我们有了更多的选择。而且，大多数开发者希望自己的站点能够使用第三方供应商提供的社交账号来实现身份验证和授权。但是，由于</span><span style="font-family: Times New Roman;"> ASP.NET Membership</span><span style="font-family: 宋体;">自身设计的限制，已经难以满足如下变化：</span></span></p>
<ul style="margin-left: 54pt;">
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">数据库架构为</span><span style="font-family: Times New Roman;"> SQL Server </span><span style="font-family: 宋体;">设计，而且无法修改。虽然你可以添加额外的用户信息，但这些数据被存入了一张不同的数据表。而且这些信息难以访问，除了使用</span><span style="font-family: Times New Roman;"> Profile Provider API</span><span style="font-family: 宋体;">。</span></span></li>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">虽然通过</span><span style="font-family: Times New Roman;">Provider</span><span style="font-family: 宋体;">，你可以对后台数据存储结构的修改，但是该</span><span style="font-family: Times New Roman;">Provider</span><span style="font-family: 宋体;">的设计是假设我们对关系型数据库进行修改。虽然你也可以写一个面向非关系型（例如</span><span style="font-family: Times New Roman;"> Windows Azure Tables</span><span style="font-family: 宋体;">）存储机制的</span><span style="font-family: Times New Roman;">Provider</span><span style="font-family: 宋体;">。但是，围绕着相关的设计，你还需要大量的工作。这包括编写大量的代码，以及为那些</span><span style="font-family: Times New Roman;"> NoSQL </span><span style="font-family: 宋体;">数据库不支持的方法抛出一大堆</span><span style="font-family: Times New Roman;"> System.NotImplementedException </span><span style="font-family: 宋体;">异常。</span></span></li>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">由于登录、注销功能基于表单身份验证，因此</span><span style="font-family: Times New Roman;">ASP.NET Membership </span><span style="font-family: 宋体;">无法支持</span><span style="font-family: Times New Roman;"> OWIN</span><span style="font-family: 宋体;">。</span><span style="font-family: Times New Roman;">OWIN </span><span style="font-family: 宋体;">包括了一些用于身份验证的</span><span style="font-family: Times New Roman;"> Middleware </span><span style="font-family: 宋体;">中间件，如支持</span><span style="font-family: Times New Roman;">Microsoft </span><span style="font-family: 宋体;">账户、</span><span style="font-family: Times New Roman;"> Facebook,</span><span style="font-family: 宋体;">、</span><span style="font-family: Times New Roman;">Google</span><span style="font-family: 宋体;">、</span><span style="font-family: Times New Roman;">Twitter </span><span style="font-family: 宋体;">等的登录，还支持来自于组织内部的账号例如</span><span style="font-family: Times New Roman;"> Active Directory </span><span style="font-family: 宋体;">、</span><span style="font-family: Times New Roman;"> Windows Azure Active Directory </span><span style="font-family: 宋体;">等登录。</span><span style="font-family: Times New Roman;">OWIN </span><span style="font-family: 宋体;">也提供了包括对</span><span style="font-family: Times New Roman;">OAuth 2.0, JWT </span><span style="font-family: 宋体;">和</span><span style="font-family: Times New Roman;">CORS</span><span style="font-family: 宋体;">的支持。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">正是由于</span><span style="font-family: Times New Roman;">ASP.NET Membership </span><span style="font-family: 宋体;">诸多限制，微软采取了一系列的补救措施，比如发布了</span><span style="font-family: Times New Roman;">ASP.NET Simple Membership </span><span style="font-family: 宋体;">和</span><span style="font-family: Times New Roman;">ASP.NET Universal Providers</span><span style="font-family: 宋体;">，他们通过</span><span style="font-family: Times New Roman;">Entity Framework</span><span style="font-family: 宋体;">的</span><span style="font-family: Times New Roman;">Code First</span><span style="font-family: 宋体;">，可以方便的去扩展用户信息，而非像</span><span style="font-family: Times New Roman;">ASP.NET Membership </span><span style="font-family: 宋体;">那样需要</span><span style="font-family: Times New Roman;">Provider </span><span style="font-family: 宋体;">来实现。</span></span></p>
<p><span style="font-family: 宋体; font-size: 15px;">但是它们仍旧存在不足，主要包括如下两点：</span></p>
<ul style="margin-left: 54pt;">
<li><span style="font-family: 宋体; font-size: 15px;">对非关系型数据库支持不好</span></li>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">无法和</span><span style="font-family: Times New Roman;">OWIN</span><span style="font-family: 宋体;">兼容</span></span></li>
</ul>
<h4><span style="font-size: 15px;">ASP.NET Identity</span></h4>
<p><span style="font-size: 15px;">由于ASP.NET Membership、<span style="font-family: Times New Roman;">ASP.NET Simple Membership </span>、<span style="font-family: Times New Roman;">ASP.NET Universal Providers</span> 设计上的不足，微软在接受了大量反馈后，于.NET Framework 4.5 中推出了ASP.NET Identity，如果用一句话概括——ASP.NET Identity 为ASP.NET 应用程序提供了一系列的API用来管理和维护用户 ，它包括如下新特性：</span></p>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;One ASP.NET Identity </span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">可以用在所有的</span><span style="font-family: Times New Roman;"> ASP.NET </span><span style="font-family: 宋体;">框架上，例如</span><span style="font-family: Times New Roman;"> ASP.NET MVC, Web Forms</span><span style="font-family: 宋体;">，</span><span style="font-family: Times New Roman;">Web Pages</span><span style="font-family: 宋体;">，</span><span style="font-family: Times New Roman;">ASP.NET Web API </span><span style="font-family: 宋体;">和</span><span style="font-family: Times New Roman;">SignalR </span></span></li>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">可以用在各种应用程序中，例如</span><span style="font-family: Times New Roman;">Web </span><span style="font-family: 宋体;">应用程序、移动应用、商店应用或者混合架构应用</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">易于管理用户信息</span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity</span><span style="font-family: 宋体;">提供了丰富的</span><span style="font-family: Times New Roman;">API </span><span style="font-family: 宋体;">，可以方便的管理用户</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">持久化控制</span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">默认情况下，</span><span style="font-family: Times New Roman;">ASP.NET Identity</span><span style="font-family: 宋体;">将用户所有的数据存储在数据库中。</span><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">使用</span><span style="font-family: Times New Roman;"> Entity Framework </span><span style="font-family: 宋体;">实现其所有的检索和持久化机制。</span></span></li>
<li><span style="font-family: 宋体; font-size: 15px;">通过Code First,你可以对数据库架构的完全控制，一些常见的任务例如改变表名称、改变主键数据类型等都可以很轻易地完成。</span></li>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">能够很容易地引入其他不同的存储机制，例如</span><span style="font-family: Times New Roman;"> SharePoint, Windows Azure </span><span style="font-family: 宋体;">存储表服务</span><span style="font-family: Times New Roman;">, NoSQL </span><span style="font-family: 宋体;">数据库等。不必再抛出</span><span style="font-family: Times New Roman;"> System.NotImplementedException </span><span style="font-family: 宋体;">异常了。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">单元测试能力</span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">能让</span><span style="font-family: Times New Roman;"> Web </span><span style="font-family: 宋体;">应用程序能够更好地进行单元测试。你可以为你应用程序使用了</span><span style="font-family: Times New Roman;"> ASP.NET Identity </span><span style="font-family: 宋体;">的部分编写单元测试。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">角色</span><span style="font-family: Times New Roman;">Provider </span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">中的角色</span><span style="font-family: Times New Roman;">Provider</span><span style="font-family: 宋体;">配合</span><span style="font-family: Times New Roman;">ASP.NET MVC Authorize</span><span style="font-family: 宋体;">，可以让你基于角色来限制对应用程序某个部分的访问。你可以很容易地创建</span><span style="font-family: Times New Roman;">Admin</span><span style="font-family: 宋体;">之类的角色，并将用户加入其中。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">基于声明的</span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">支持基于声明的身份验证，它使用一组"声明"来表示用户的身份标识。相对于"角色"，"声明"能使开发人员能够更好地描述用户的身份标识。</span><span style="font-family: 宋体;">"角色"本质上只是一个布尔类型（即"属于"或"不属于"特定角色），而一个"声明"可以包含更多关于用户标识和成员资格的信息。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="font-family: 宋体;">社交账号登录</span><span style="font-family: Times New Roman;">Provider </span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">你可以很容易的为你的应用程序加入社交账号登录功能（例如</span><span style="font-family: Times New Roman;"> Microsoft </span><span style="font-family: 宋体;">账户，</span><span style="font-family: Times New Roman;">Facebook,</span><span style="font-family: 宋体;">，</span><span style="font-family: Times New Roman;">Twitter</span><span style="font-family: 宋体;">，</span><span style="font-family: Times New Roman;">Google </span><span style="font-family: 宋体;">等），并将用户特定的数据存入你的应用程序。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;Windows Azure Active Directory </span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: 宋体;">你还可以加入使用</span><span style="font-family: Times New Roman;"> Windows Azure Active Directory </span><span style="font-family: 宋体;">进行登录的功能，并将用户特定的数据存入你的应用程序。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;OWIN </span><span style="font-family: 宋体;">集成</span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET </span><span style="font-family: 宋体;">身份验证现在是基于</span><span style="font-family: Times New Roman;"> OWIN </span><span style="font-family: 宋体;">中间件实现，并且可以在任何基于</span><span style="font-family: Times New Roman;"> OWIN </span><span style="font-family: 宋体;">的宿主上使用。</span><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">不依赖</span><span style="font-family: Times New Roman;">System.Web</span><span style="font-family: 宋体;">程序集，与此同时，它完全兼容于</span><span style="font-family: Times New Roman;"> OWIN </span><span style="font-family: 宋体;">框架，并且能被用在任何基于</span><span style="font-family: Times New Roman;">OWIN </span><span style="font-family: 宋体;">的</span><span style="font-family: Times New Roman;">Host</span><span style="font-family: 宋体;">和</span><span style="font-family: Times New Roman;">Server </span><span style="font-family: 宋体;">之上。</span></span></li>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity</span><span style="font-family: 宋体;">使用</span><span style="font-family: Times New Roman;">OWIN Authentication</span><span style="font-family: 宋体;">来登录、登出操作。这意味着应用程序使用</span><span style="color: #222222; font-family: &#39;Segoe UI&#39;;">CookieAuthentication&nbsp;</span><span style="font-family: 宋体;">生成</span><span style="font-family: Times New Roman;"> cookie </span><span style="font-family: 宋体;">而非</span><span style="color: #222222; font-family: &#39;Segoe UI&#39;;">FormsAuthentication&nbsp;</span><span style="font-family: 宋体;">。</span></span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">•</span><span style="font-family: Times New Roman;">&nbsp;&nbsp;&nbsp;&nbsp;NuGet </span><span style="font-family: 宋体;">包</span></span></p>
<ul>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity </span><span style="font-family: 宋体;">作为一个</span><span style="font-family: Times New Roman;"> NuGet </span><span style="font-family: 宋体;">包进行发布，并且安装在</span><span style="font-family: Times New Roman;">ASP.NET MVC</span><span style="font-family: 宋体;">，</span><span style="font-family: Times New Roman;">Web Forms </span><span style="font-family: 宋体;">和</span><span style="font-family: Times New Roman;"> ASP.NET Web API </span><span style="font-family: 宋体;">项目模板中。当然，你也可以从</span><span style="font-family: Times New Roman;"> NuGet </span><span style="font-family: 宋体;">库中下载它。</span></span></li>
<li><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity</span><span style="font-family: 宋体;">以</span><span style="font-family: Times New Roman;">NuGet</span><span style="font-family: 宋体;">包的形式发布，这样能让</span><span style="font-family: Times New Roman;">ASP.NET </span><span style="font-family: 宋体;">团队更好的</span><span style="font-family: Times New Roman;">Bug</span><span style="font-family: 宋体;">修复和迭代新功能，与此同时，开发人员可以在第一时间获取到最新版本。</span></span></li>
</ul>
<div style="text-align: right"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_labelTop">回到顶部</a><a name="_label1"></a></div><h3><span style="font-size: 15px;">建立 ASP.NET Identity</span></h3>
<h4><span style="font-size: 15px;">创建 ASP.NET Identity数据库</span></h4>
<p><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity</span><span style="font-family: 宋体;">并不像</span><span style="font-family: Times New Roman;">ASP.NET Membership</span><span style="font-family: 宋体;">那样依赖</span><span style="font-family: Times New Roman;">SQL Server</span><span style="font-family: 宋体;">架构，但关系型存储仍然是默认和最简单的实现方式，尽管近些年来</span><span style="font-family: Times New Roman;">NoSQL</span><span style="font-family: 宋体;">发展迅猛，但关系型数据库易于理解，仍旧是开发团队内部主流的存储选择。</span></span></p>
<p><span style="font-size: 15px;"><span style="font-family: Times New Roman;">ASP.NET Identity</span><span style="font-family: 宋体;">使用</span><span style="font-family: Times New Roman;">Entity Framework Code First</span><span style="font-family: 宋体;">来自动创建数据库架构。在此示例中，我使用</span><span style="font-family: Times New Roman;">localdb</span><span style="font-family: 宋体;">来创建一个空的数据库</span><span style="font-family: Times New Roman;">IdentityDb</span><span style="font-family: 宋体;">，然后交由</span><span style="font-family: Times New Roman;">Code First</span><span style="font-family: 宋体;">管理数据库架构。</span></span></p>
<p><span style="font-size: 15px;"><span style="font-family: Times New Roman;">localdb</span><span style="font-family: 宋体;">内置在</span><span style="font-family: Times New Roman;">Visual Studio</span><span style="font-family: 宋体;">中而且它是轻量级的</span><span style="font-family: Times New Roman;">SQL Server</span><span style="font-family: 宋体;">，能让开发者简单快速操作数据库。</span></span></p>
<h4><span style="font-size: 15px;">添加ASP.NET Identity 包</span></h4>
<p><span style="font-size: 15px;"><span style="font-family: Times New Roman;">Identity</span><span style="font-family: 宋体;">以包的形式发布在</span><span style="font-family: Times New Roman;">NuGet</span><span style="font-family: 宋体;">上，这能够很方便的将它安装到任意项目中，通过在</span><span style="font-family: Times New Roman;">Package Manger Console</span><span style="font-family: 宋体;">输入如下命令来安装</span><span style="font-family: Times New Roman;">Identity</span><span style="font-family: 宋体;">：</span></span></p>
<ul>
<li><span style="color: #1e1e1e; font-family: Consolas; font-size: 15px;"><span style="background-color: white;">Install-Package Microsoft.AspNet.Identity.EntityFramework</span> </span></li>
<li><span style="color: #1e1e1e; font-family: Consolas; font-size: 15px;"><span style="background-color: white;">Install-Package Microsoft.AspNet.Identity.OWIN</span> </span></li>
<li><span style="color: #1e1e1e; font-family: Consolas; font-size: 15px; background-color: white;">Install-Package Microsoft.Owin.Host.SystemWeb</span></li>
</ul>
<p><span style="font-size: 15px;"><span style="font-family: 宋体;">在</span><span style="font-family: Times New Roman;"> Visual Studio</span><span style="font-family: 宋体;">中选择创建一个完整的</span><span style="font-family: Times New Roman;">ASP.NET MVC</span><span style="font-family: 宋体;">项目时，默认情况下该模板会使用</span><span style="font-family: Times New Roman;">ASP.NET Identity API</span><span style="font-family: 宋体;">自动添加通用的用户管理模块。对于初学者，我建议学习它里面</span><span style="font-family: Times New Roman;">API</span><span style="font-family: 宋体;">的使用，但我不推荐将它使用在正式环境中，因为它产生了过多的通用和冗余代码，</span><span style="font-family: 宋体;">有时候我们只想让它简单工作。</span></span></p>
<h4><span style="font-size: 15px;">更新Web.config文件</span></h4>
<p><span style="font-size: 15px;">若要将ASP.NET Identity使用在项目里，除了添加相应的包之外，还需要在Web.config中添加如下配置信息：</span></p>
<ul>
<li><span style="font-size: 15px;">数据库连接字符串</span></li>
<li><span style="font-size: 15px;">指定的OWIN Startup启动项，用作初始化Middleware至Pipeline</span></li>
</ul>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="color: blue; font-size: 15px;">&lt;<span style="color: maroon;">connectionStrings<span style="color: blue;">&gt;</span> </span></span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;<span style="color: blue;">&lt;<span style="color: maroon;">add</span> <span style="color: red;">name</span>="IdentityDb"</span> <span style="color: red;">providerName</span>=<span style="color: blue;">"System.Data.SqlClient"</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: red;">connectionString</span>=<span style="color: blue;">"Data Source=(localdb)\v11.0;Initial Catalog=IdentityDb;Integrated Security=True;Connect Timeout=15;Encrypt=False;TrustServerCertificate=False; MultipleActiveResultSets=True"</span> <span style="color: blue;">/&gt;</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="color: blue; font-size: 15px;">&lt;/<span style="color: maroon;">connectionStrings<span style="color: blue;">&gt;</span> </span></span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="color: blue; font-size: 15px;">&lt;<span style="color: maroon;">appSettings<span style="color: blue;">&gt;</span> </span></span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;<span style="color: blue;">&lt;<span style="color: maroon;">add</span> <span style="color: red;">key</span>="owin:AppStartup"</span> <span style="color: red;">value</span>=<span style="color: blue;">"UsersManagement.IdentityConfig"</span> <span style="color: blue;">/&gt;</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="color: blue; font-size: 15px;">&lt;/<span style="color: maroon;">appSettings<span style="color: blue;">&gt;</span> </span></span></div>
</li>
</ol>
<h4><span style="font-size: 15px;"><span style="font-family: 宋体;">创建</span>Entity Framework <span style="font-family: 宋体;">类</span></span></h4>
<p><span style="font-size: 15px;">如果大家使用过ASP.NET Membership，对比过后你会发现在ASP.NET Identity扩展User信息是多么的简单和方便。</span></p>
<p><strong><span style="font-size: 15px;">1.创建 User 类</span></strong></p>
<p><span style="font-size: 15px;">第一个要被创建的类它代表用户，我将它命名为AppUser，继承自Microsoft.AspNet.Identity.EntityFramework 名称空间下IdentityUser，IdentityUser 提供了基本的用户信息，如Email、PasswordHash、UserName、PhoneNumber、Roles等，当然我们也可以在其派生类中添加额外的信息，代码如下：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">using</span> Microsoft.AspNet.Identity.EntityFramework; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">namespace</span> UsersManagement.Models </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">class</span> AppUser:IdentityUser </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;">}</div>
</li>
</ol>
<p><strong>2.创建 Database Context 类</strong></p>
<p><span style="font-size: 15px;">接下来的步骤就是创建EF Database Context 来操作AppUser。ASP.NET Identity将使用Code First 来创建和管理数据库架构。值得注意的是，Database Context必须继承自<span style="color: #2b91af; font-family: 微软雅黑; background-color: white;">IdentityDbContext&lt;T&gt;</span>，而且T为User类（在此示例即AppUser），代码如下所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> AppIdentityDbContext : IdentityDbContext&lt;AppUser&gt; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> AppIdentityDbContext() : <span style="color: blue;">base</span>("<span style="color: darkred;"><a name="OLE_LINK1"></a>IdentityDb</span>") </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">static</span> AppIdentityDbContext() </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Database.SetInitializer&lt;AppIdentityDbContext&gt;(<span style="color: blue;">new</span> IdentityDbInit()); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">static</span> AppIdentityDbContext Create() </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> <span style="color: blue;">new</span> AppIdentityDbContext(); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">class</span> IdentityDbInit : DropCreateDatabaseIfModelChanges&lt;AppIdentityDbContext&gt; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">protected</span> <span style="color: blue;">override</span> <span style="color: blue;">void</span> Seed(AppIdentityDbContext context) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PerformInitialSetup(context); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">base</span>.Seed(context); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">void</span> PerformInitialSetup(AppIdentityDbContext context) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//初始<span style="font-family: 宋体;">化</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;} </span></div>
</li>
</ol>
<p><span style="font-size: 15px;">上述代码中，AppIdentityDbContext 的构造函数调用基类构造函数并将数据库连接字符串的Name作为参数传递，它将用作连接数据库。同时，当Entity Framework Code First成功创建数据库架构后，AppIdentityDbContext的静态构造函数调用Database.SetInitializer方法Seed 数据库而且只执行一次。在这儿，我的Seed 类IdentityDbInit。</span></p>
<p><span style="font-size: 15px;">最后，AppIdentityDbContext 定义了 Create方法，它将被 OWIN Middleware回掉然后返回AppIdentityDbContext实例，这个实例被存储在OwinContext中。</span></p>
<p><strong><span style="font-size: 15px;">3.创建User Manger 类</span></strong></p>
<p><span style="font-size: 15px;">User Manager类作为ASP.NET Identity中最为重要的类之一，用来管理User。同样，自定义的User Manger类必须继承自<span style="color: #2b91af; font-family: 微软雅黑;"><span style="background-color: white;">UserManager<span style="color: black;">&lt;<span style="color: #2b91af;">T<span style="color: black;"> &gt;，此处</span></span></span></span>T<span style="color: black;">就为AppUser。<strong>UserManager&lt;T&gt;提供了创建和操作用户的一些基本方法并且全面支持C# 异步编程</strong>，所以你可以使用CreateAsync(Create)，FindAsync(Find)、DeleteAsync(Delete)、UpdateAsync（Update）来进行用户管理，值得注意的是，它并不通过Entity Framework 来直接操作用户，而是间接调用UserStore来实现。UserStore&lt;T&gt;是Entity Framework 类并实现了IUserStore&lt;T&gt;接口，并且实现了定义在UserManger中操作用户的方法。代码如下所示： </span></span></span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: gray;">/// &lt;summary&gt;</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: gray;">/// 用户管<span style="font-family: 宋体;">理</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: gray;">/// &lt;/summary&gt;</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">class</span> AppUserManager : UserManager&lt;AppUser&gt; { </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> AppUserManager(IUserStore&lt;AppUser&gt; store) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span style="color: blue;">base</span>(store) { </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">static</span> AppUserManager Create( </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityFactoryOptions&lt;AppUserManager&gt; options, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IOwinContext context) { </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AppIdentityDbContext db = context.Get&lt;AppIdentityDbContext&gt;(); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//UserStore&lt;T&gt; 是 包含在 Microsoft.AspNet.Identity.EntityFramework 中，它实现了 UserManger 类中与用户操作相关的方法。 </span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//也就是说UserStore&lt;T&gt;类中的方法（诸如：FindById、FindByNameAsync...）通过EntityFramework检索和持久化UserInfo到数据库<span style="font-family: 宋体;">中</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AppUserManager manager = <span style="color: blue;">new</span> AppUserManager(<span style="color: blue;">new</span> UserStore&lt;AppUser&gt;(db)); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> manager; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;}</span></div>
</li>
</ol>
<p><span style="font-size: 15px;">上述代码中，静态的Create方法将返回AppUserManger实例，它用来操作和管理用户，值得注意的是，它需要传入OwinContext对象，通过该上下文对象，获取到存储在Owin环境字典中的Database Context实例。</span></p>
<p><strong><span style="font-size: 15px;">4.创建OWIN Startup 类</span></strong></p>
<p><span style="font-size: 15px;">最后，通过Katana（OWIN的实现）提供的API，将Middleware 中间件注册到Middleware中，如下所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> IdentityConfig </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">void</span> Configuration(IAppBuilder app) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//1.使用app.Use方法将IdentityFactoryMiddleware和参数callback回掉函数注册到Owin Pipeline<span style="font-family: 宋体;">中</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//app.Use(typeof(IdentityFactoryMiddleware&lt;T, IdentityFactoryOptions&lt;T&gt;&gt;), args);</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//2.当IdentityFactoryMiddleware中间件被Invoke执行时，执行callback回掉函数，返回具体实例Instance</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//TResult instance = ((IdentityFactoryMiddleware&lt;TResult, TOptions&gt;) this).Options.Provider.Create(((IdentityFactoryMiddleware&lt;TResult, TOptions&gt;) this).Options, context);</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//3.将返回的实例存储在Owin Context<span style="font-family: 宋体;">中</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//context.Set&lt;TResult&gt;(instance);</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.CreatePerOwinContext&lt;AppIdentityDbContext&gt;(AppIdentityDbContext.Create); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.CreatePerOwinContext&lt;AppUserManager&gt;(AppUserManager.Create); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;app.UseCookieAuthentication(<span style="color: blue;">new</span> CookieAuthenticationOptions </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AuthenticationType = DefaultAuthenticationTypes.ApplicationCookie, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;LoginPath = <span style="color: blue;">new</span> PathString("<span style="color: darkred;">/Account/Login</span>"), </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
</ol>
<p><span style="font-size: 15px;">上述代码中，通过CreatePerOwinContext方法将AppIdentityDbContext和 AppUserManager的实例注册到OwinContext中，这样确保每一次请求都能获取到相关ASP.NET Identity对象，而且还能保证全局唯一。</span></p>
<p><span style="font-size: 15px;">UseCookieAuthentication 方法指定了身份验证类型为ApplicationCookie，同时指定LoginPath属性，当Http请求内容认证不通过时重定向到指定的URL。</span></p>
<div style="text-align: right"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_labelTop">回到顶部</a><a name="_label2"></a></div><h3><span style="font-size: 15px;"><span style="font-family: 宋体;">使用</span>ASP.NET Identity</span></h3>
<p><span style="font-size: 15px;">成功建立ASP.NET Identity之后，接下来就是如何去使用它了，让我们再回顾一下ASP.NET Identity的几个重要知识点：</span></p>
<ul>
<li><span style="font-size: 15px;">大多数应用程序需要用户、角色管理，ASP.NET Identity提供了API用来管理用户和身份验证</span></li>
<li><span style="font-size: 15px;">ASP.NET Identity 可以运用到多种场景中，通过对用户、角色的管理，可以联合ASP.NET MVC <span style="color: #2b91af; font-family: 微软雅黑;"><span style="background-color: white;">Authorize</span> </span>过滤器 来实现授权功能。</span></li>
</ul>
<h4><span style="font-size: 15px;">获取所有的Users对象</span></h4>
<p><span style="font-size: 15px;">在上一小节中，通过CreatePerOwinContext方法将AppIdentityDbContext和 AppUserManager的实例注册到OwinContext中，我们可以通过OwinContext对象的Get方法来获取到他们，将下面代码放在Controller中，方便供Action获取对象：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">private</span> AppUserManager UserManager </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">get</span> { <span style="color: blue;">return</span> HttpContext.GetOwinContext().GetUserManager&lt;AppUserManager&gt;(); } </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;}</span></div>
</li>
</ol>
<p><span style="font-size: 15px;">在上述代码中，通过<span style="color: green; font-family: 微软雅黑;"><span style="background-color: white;">Microsoft.Owin.Host.SystemWeb</span> </span>程序集，为HttpContext增加了扩展方法<span style="color: black; font-family: 微软雅黑;"><span style="background-color: white;">GetOwinContext，返回的 Owin</span>Context<span style="background-color: white;">对象是对Http请求的封装，所以GetOwinContext方法</span>可以获取到每一次Http请求的内容。接着通过<span style="background-color: white;">IOwinContext</span>的扩展方法<span style="background-color: white;">GetUserManager获取到存储在Owin</span>Context中的UserManager实例。 </span></span></p>
<p><span style="color: black; font-family: 微软雅黑; font-size: 15px;">然后，通过UserManager的Users属性，可以获取到所有的User集合，如下所示： </span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> ActionResult Index() </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> View(UserManager.Users); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<h4><span style="font-size: 15px;">创建User对象</span></h4>
<p><span style="font-size: 15px;">通过UserManager的CreateAsync方法，可以快速的创建User对象，如下代码创建了User ViewModel:</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> UserViewModel </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;[Required] </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">string</span> Name { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; } </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;[Required] </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">string</span> Email { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; } </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;[Required] </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">string</span> Password { <span style="color: blue;">get</span>; <span style="color: blue;">set</span>; } </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<p><span style="font-size: 15px;">使用UserManager对象的CreateAsync方法将AppUser对象将它持久化到数据库：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">[HttpPost] </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> async Task&lt;ActionResult&gt; Create(UserViewModel model) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (ModelState.IsValid) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;var user = <span style="color: blue;">new</span> AppUser {UserName = model.Name, Email = model.Email}; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//传入Password并转换成PasswordHash</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult result = await UserManager.CreateAsync(user, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;model.Password); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (result.Succeeded) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> RedirectToAction("<span style="color: darkred;">Index</span>"); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddErrorsFromResult(result); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> View(model); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<p><span style="font-size: 15px;">CreateAsync返回<span style="color: #2b91af; font-family: 微软雅黑; background-color: white;">IdentityResult </span>类型对象，它包含如下了两个重要属性：</span></p>
<ul>
<li><span style="font-size: 15px;">Succeeded : 如果操作成功返回True</span></li>
<li><span style="font-size: 15px;">Errors：返回一个字符串类型的错误集合</span></li>
</ul>
<p><span style="font-size: 15px;">通过AddErrorsFromResult <a href="mailto:%E6%96%B9%E6%B3%95%E5%B0%86%E9%94%99%E8%AF%AF%E9%9B%86%E5%90%88%E5%B1%95%E7%A4%BA%E5%9C%A8%E9%A1%B5%E9%9D%A2%E4%B8%8A@Html.ValidationSummary">方法将错误集合展示在页面上 @Html.ValidationSummary</a> 处，如下所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">private</span> <span style="color: blue;">void</span> AddErrorsFromResult(IdentityResult result) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">foreach</span> (<span style="color: blue;">string</span> error <span style="color: blue;">in</span> result.Errors) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModelState.AddModelError("", error); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<h4><span style="font-size: 15px;">添加自定义密码验证策略</span></h4>
<p><span style="font-size: 15px;">有时候，我们需要实现密码策略，如同AD中控制那样，密码复杂度越高，那么它被破译的概率就越低。</span></p>
<p><span style="font-size: 15px;">ASP.NET Identity 提供了<span style="color: #2b91af; font-family: 微软雅黑; background-color: white;">PasswordValidator</span>类，提供了如下属性来配置密码策略：</span></p>
<div>
<table style="border-collapse: collapse; height: 278px; width: 987px;" border="1" cellspacing="1" cellpadding="1"><colgroup><col style="width: 312px;"><col style="width: 312px;"></colgroup>
<tbody valign="top">
<tr>
<td style="padding-left: 7px; padding-right: 7px; border: solid 0.5pt;">
<p><span style="font-family: &#39;Times New Roman&#39;; font-size: 15px;">RequiredLength</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: solid 0.5pt; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">指定有效的密码最小长度</span></p>
</td>
</tr>
<tr>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-family: &#39;Times New Roman&#39;; font-size: 15px;">RequireNonLetterOrDigit</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">当为True时，有效的密码必须包含一个字符，它既不是数字也不是字母</span></p>
</td>
</tr>
<tr>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-family: &#39;Times New Roman&#39;; font-size: 15px;">RequireDigit</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">当为True时，有效密码必须包含数字</span></p>
</td>
</tr>
<tr>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-family: &#39;Times New Roman&#39;; font-size: 15px;">RequireLowercase</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">当为True时，有效密码必须包含一个小写字符</span></p>
</td>
</tr>
<tr>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-family: &#39;Times New Roman&#39;; font-size: 15px;">RequireUppercase</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">当为True时，有效密码必须包含一个大写字符</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p><span style="font-size: 15px;">&nbsp;</span></p>
<p><span style="font-size: 15px;">如果这些预定义属性无法满足我们的需求时，我们可以添加自定义的密码验证策略，只要继承<span style="color: #2b91af; font-family: 微软雅黑;"><span style="background-color: white;">PasswordValidator</span> </span>并且Override ValidateAsync方法即可，如下代码所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> CustomPasswordValidator : PasswordValidator </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">override</span> async Task&lt;IdentityResult&gt; ValidateAsync(<span style="color: blue;">string</span> password) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult result = await <span style="color: blue;">base</span>.ValidateAsync(password); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (password.Contains("<span style="color: darkred;">12345</span>")) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;<span style="color: blue;">string</span>&gt; errors = result.Errors.ToList(); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errors.Add("<span style="color: darkred;">密码不能包含连续数字</span>"); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = <span style="color: blue;">new</span> IdentityResult(errors); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> result; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;}</span></div>
</li>
</ol>
<p><span style="font-size: 15px;"><strong>上述代码中，值得注意的是，IdentityResult 对象的 Errors是只读的，所以无法直接赋值，只能通过实例化IdentityResult 类并通过构造函数传入Errors。 </strong></span></p>
<p><span style="font-size: 15px;">自定义的密码策略创建完毕过后，接着就将它附加到UserManager对象的PasswordValidator 属性上，如下代码所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: green;">//自定义的Password Validator</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">manager.PasswordValidator = <span style="color: blue;">new</span> CustomPasswordValidator </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;RequiredLength = 6, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;RequireNonLetterOrDigit = <span style="color: blue;">false</span>, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;RequireDigit = <span style="color: blue;">false</span>, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;RequireLowercase = <span style="color: blue;">true</span>, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;RequireUppercase = <span style="color: blue;">true</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">}; </span></div>
</li>
</ol>
<h4><span style="font-size: 15px;">更多用户验证策略</span></h4>
<p><span style="font-size: 15px;">UserManager 除了<strong>PasswordValidator</strong>之外，还提供了一个更加<strong>通用</strong>的属性：<strong>UserValidator</strong> ，它包含如下两个策略属性：</span></p>
<div>
<table style="border-collapse: collapse; height: 93px; width: 864px;" border="0"><colgroup><col style="width: 312px;"><col style="width: 312px;"></colgroup>
<tbody valign="top">
<tr>
<td style="padding-left: 7px; padding-right: 7px; border: solid 0.5pt;">
<p><span style="color: black; font-family: 微软雅黑; font-size: 15px; background-color: white;">AllowOnlyAlphanumericUserNames</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: solid 0.5pt; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">当为True时，UserName只能包含字母数字</span></p>
</td>
</tr>
<tr>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: solid 0.5pt; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="color: black; font-family: 微软雅黑; font-size: 15px; background-color: white;">RequireUniqueEmail</span></p>
</td>
<td style="padding-left: 7px; padding-right: 7px; border-top: none; border-left: none; border-bottom: solid 0.5pt; border-right: solid 0.5pt;">
<p><span style="font-size: 15px;">当为True时，Email地址必须唯一</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p><span style="font-size: 15px;">&nbsp;</span></p>
<p><span style="font-size: 15px;">当然这两种策略如果不满足我们的需求的话，我们也可以像Password那样去定制化，只要 继承<span style="color: #2b91af; font-family: 微软雅黑;"><span style="background-color: white;">UserValidator<span style="color: black;">&lt;<span style="color: #2b91af;">T<span style="color: black;">&gt;</span></span></span></span> <span style="color: black;"><span style="background-color: white;">然后</span> Override <span style="background-color: white;">ValidateAsync</span> <span style="background-color: white;">方法，如下所示：</span> </span></span></span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> <span style="color: blue;">class</span> CustomUserValidator : UserValidator&lt;AppUser&gt; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> CustomUserValidator(AppUserManager mgr) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span style="color: blue;">base</span>(mgr) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">public</span> <span style="color: blue;">override</span> async Task&lt;IdentityResult&gt; ValidateAsync(AppUser user) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult result = await <span style="color: blue;">base</span>.ValidateAsync(user); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (!user.Email.ToLower().EndsWith("<span style="color: darkred;">@jkxy.com</span>")) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;List&lt;<span style="color: blue;">string</span>&gt; errors = result.Errors.ToList(); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;errors.Add("<span style="color: darkred;">Email 地址只支持jkxy域名</span>"); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result = <span style="color: blue;">new</span> IdentityResult(errors); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> result; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<p><span style="font-size: 15px;">上述代码增强了对Email的验证，必须为@jkxy域名，然后将自定义的UserValidator 附加到User Manger 对象上：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: green;">//自定义的User Validator</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">manager.UserValidator = <span style="color: blue;">new</span> CustomUserValidator(manager) { </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;AllowOnlyAlphanumericUserNames = <span style="color: blue;">true</span>, </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;RequireUniqueEmail = <span style="color: blue;">true</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">}; </span></div>
</li>
</ol>
<div style="text-align: right"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_labelTop">回到顶部</a><a name="_label3"></a></div><h3><span style="font-size: 15px;">ASP.NET Identity <span style="font-family: 宋体;">其他</span>API<span style="font-family: 宋体;">介绍</span></span></h3>
<p><span style="font-size: 15px;">在上一小节中，介绍了CreateAsync 的使用，接下来一鼓作气，继续ASP.NET Identity之旅。</span></p>
<h4><span style="font-size: 15px;">实现Delete 用户功能</span></h4>
<p><span style="font-size: 15px;">按照我们的经验，若要删除一个用户，首先需要Find 它。通过UserManager 对象的 FindByIdAsync来找到要被删除的对象，如果该对象不为null，那么再调用UserManager对象的DeleteAsync来删除它，如下所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">[HttpPost] </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> async Task&lt;ActionResult&gt; Delete(<span style="color: blue;">string</span> id) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;AppUser user = await UserManager.FindByIdAsync(id); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (user != <span style="color: blue;">null</span>) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult result = await UserManager.DeleteAsync(user); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (result.Succeeded) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> RedirectToAction("<span style="color: darkred;">Index</span>"); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> View("<span style="color: darkred;">Error</span>", result.Errors); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> View("<span style="color: darkred;">Error</span>", <span style="color: blue;">new</span>[] {"<span style="color: darkred;">User Not Found</span>"}); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<h4><span style="font-size: 15px;">实现编辑用户操作</span></h4>
<p><span style="font-size: 15px;">因为编辑操作UpdateAsync 只接受一个参数，而不像CreateAsync那样可以传入Password，所以我们需要手动的去校验并给PasswordHash属性赋值，当密码策略验证通过时再去验证Email策略，这样确保没有脏数据，如下所示：</span></p>
<ol>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">[HttpPost] </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;"><span style="color: blue;">public</span> async Task&lt;ActionResult&gt; Edit(<span style="color: blue;">string</span> id, <span style="color: blue;">string</span> email, <span style="color: blue;">string</span> password) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//根据Id找到AppUser对<span style="font-family: 宋体;">象</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;AppUser user = await UserManager.FindByIdAsync(id); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (user != <span style="color: blue;">null</span>) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult validPass = <span style="color: blue;">null</span>; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (password != <span style="color: blue;">string</span>.Empty) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//验证密码是否满足要<span style="font-family: 宋体;">求</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;validPass = await UserManager.PasswordValidator.ValidateAsync(password); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (validPass.Succeeded) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.PasswordHash = UserManager.PasswordHasher.HashPassword(password); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">else</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddErrorsFromResult(validPass); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: green;">//验证Email是否满足要<span style="font-family: 宋体;">求</span></span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;user.Email = email; </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult validEmail = await UserManager.UserValidator.ValidateAsync(user); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (!validEmail.Succeeded) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddErrorsFromResult(validEmail); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> ((validEmail.Succeeded &amp;&amp; validPass == <span style="color: blue;">null</span>) || (validEmail.Succeeded &amp;&amp; validPass.Succeeded)) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IdentityResult result = await UserManager.UpdateAsync(user); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;</span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">if</span> (result.Succeeded) </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> RedirectToAction("<span style="color: darkred;">Index</span>"); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AddErrorsFromResult(result); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">else</span> </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;{ </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ModelState.AddModelError("", "<span style="color: darkred;">无法找到改用户</span>"); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;} </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color: blue;">return</span> View(user); </span></div>
</li>
<li>
<div style="background: #f4f4f4;"><span style="font-size: 15px;">} </span></div>
</li>
</ol>
<div style="text-align: right"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#_labelTop">回到顶部</a><a name="_label4"></a></div><h3><span style="font-size: 15px;">小节</span></h3>
<blockquote>
<p><span style="font-size: 15px;">在这篇文章中，我为大家介绍了什么是ASP.NET Identity以及怎样配置和创建它的基础类，然后演示使用API 进行用户的管理。在下一篇文章中，继续ASP.NET Identity之旅，探索身份验证和授权的使用，谢谢 。</span></p>
</blockquote></div><div id="MySignature" style="display: block;"> <fieldset style="background-color:#ffffa0; font-family:微软雅黑; font-size:15px;color:Black; width:650px;">
  <legend><a href="http://creativecommons.org/licenses/by/2.5/cn/"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/88x31.png"></a></legend>
<div style=" border-style:dotted;">
本博客为<a href="http://www.cnblogs.com/OceanEyes/p/www.cnblogs.com/oceaneyes" target="_blank">木宛城主</a>原创，基于<a href="http://creativecommons.org/licenses/by/2.5/cn/">Creative Commons Attribution 2.5 China Mainland License</a>发布，欢迎转载，演绎或用于商业目的，但是必须保留本文的署名<a href="http://www.cnblogs.com/OceanEyes/p/www.cnblogs.com/oceaneyes" target="_blank">木宛城主</a>（包含链接）。如您有任何疑问或者授权方面的协商，请给我留言。
</div>
</fieldset></div>
<div class="clear"></div>
<div id="blog_post_info_block">
<div id="BlogPostCategory">分类: <a href="http://www.cnblogs.com/OceanEyes/category/393525.html" target="_blank">ASP.NET MVC</a>,<a href="http://www.cnblogs.com/OceanEyes/category/696137.html" target="_blank">ASP.NET MVC 随想录</a></div>
<div id="EntryTag"></div>
<div id="blog_post_info"><div id="green_channel">
        <a href="javascript:void(0);" id="green_channel_digg" onclick="DiggIt(4703547,cb_blogId,1);green_channel_success(this,&#39;谢谢推荐！&#39;);">好文要顶</a>
            <a id="green_channel_follow" onclick="follow(&#39;7d9cc6a0-df7a-e011-a53f-842b2b196315&#39;);" href="javascript:void(0);">关注我</a>
    <a id="green_channel_favorite" onclick="AddToWz(cb_entryId);return false;" href="javascript:void(0);">收藏该文</a>
    <a id="green_channel_weibo" href="javascript:void(0);" title="分享至新浪微博" onclick="ShareToTsina()"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/icon_weibo_24.png" alt=""></a>
    <a id="green_channel_wechat" href="javascript:void(0);" title="分享至微信" onclick="shareOnWechat()"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/wechat.png" alt=""></a>
</div>
<div id="author_profile">
    <div id="author_profile_info" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/OceanEyes/" target="_blank"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/20150329043854.png" class="author_avatar" alt=""></a>
        <div id="author_profile_detail" class="author_profile_info">
            <a href="http://home.cnblogs.com/u/OceanEyes/">木宛城主</a><br>
            <a href="http://home.cnblogs.com/u/OceanEyes/followees">关注 - 0</a><br>
            <a href="http://home.cnblogs.com/u/OceanEyes/followers">粉丝 - 1454</a>
        </div>
    </div>
    <div class="clear"></div>
    <div id="author_profile_honor">荣誉：<a href="http://www.cnblogs.com/expert/" target="_blank">推荐博客</a></div>
    <div id="author_profile_follow">
                <a href="javascript:void(0);" onclick="follow(&#39;7d9cc6a0-df7a-e011-a53f-842b2b196315&#39;);return false;">+加关注</a>
    </div>
</div>
<div id="div_digg"><div style="padding-bottom: 5px"><span class="icon_favorite" style="padding-top: 2px; padding-bottom: 2px"></span><a onclick="follow(&#39;7d9cc6a0-df7a-e011-a53f-842b2b196315&#39;);" href="javascript:void(0);" style="font-weight: bold; padding-left: 5px;">关注木宛城主</a></div>
    <div class="diggit" onclick="votePost(4703547,&#39;Digg&#39;)">
        <span class="diggnum" id="digg_count">108</span>
    </div>
    <div class="buryit" onclick="votePost(4703547,&#39;Bury&#39;)">
        <span class="burynum" id="bury_count">7</span>
    </div>
    <div class="clear"></div>
    <div class="diggword" id="digg_tips">
    </div>
</div>
</div>
<div class="clear"></div>
<div id="post_next_prev"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-create-custom-middleware.html" class="p_n_p_prefix">« </a> 上一篇：<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-create-custom-middleware.html" title="发布于2015-07-06 23:36">ASP.NET MVC随想录——创建自定义的Middleware中间件</a><br><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-apply-asp-net-identity-authentication.html" class="p_n_p_prefix">» </a> 下一篇：<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-apply-asp-net-identity-authentication.html" title="发布于2015-09-06 22:54">ASP.NET MVC 随想录——探索ASP.NET Identity 身份验证和基于角色的授权，中级篇</a><br></div>
</div>


		</div>
		<div class="postDesc">posted @ <span id="post-date">2015-08-05 00:35</span> <a href="http://www.cnblogs.com/OceanEyes/">木宛城主</a> 阅读(<span id="post_view_count">24793</span>) 评论(<span id="post_comment_count">68</span>)  <a href="https://i.cnblogs.com/EditPosts.aspx?postid=4703547" rel="nofollow">编辑</a> <a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#" onclick="AddToWz(4703547);return false;">收藏</a></div>
	</div>
	<script type="text/javascript">var allowComments=true,cb_blogId=88841,cb_entryId=4703547,cb_blogApp=currentBlogApp,cb_blogUserGuid='7d9cc6a0-df7a-e011-a53f-842b2b196315',cb_entryCreatedDate='2015/8/5 0:35:00';loadViewCount(cb_entryId);</script>
	
</div><!--end: topics 文章、评论容器-->
</div><a name="!comments"></a><div id="blog-comments-placeholder"><div id="comments_pager_top"><div class="pager"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#!comments" onclick="commentManager.renderComments(1,50);return false;">&lt; Prev</a><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#!comments" onclick="commentManager.renderComments(1,50);return false;">1</a><span class="current">2</span></div></div>
<!--done-->
<div class="feedback_area_title">评论列表</div>
<div class="feedbackNoItems"></div>
	

		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3279618" class="layer">#51楼</a><a name="3279618" id="comment_anchor_3279618"></a>  <span class="comment_date">2015-10-07 21:17</span> <a id="a_comment_author_3279618" href="http://home.cnblogs.com/u/818375/" target="_blank">phbrother003</a> <a href="http://msg.cnblogs.com/send/phbrother003" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3279618" class="blog_comment_body">您好，我在创业中，已经拿到投资，游戏产品已经完成，现在在处理游戏细节，等细节处理完成后做上线前的准备。<br>现在在招人，请问有兴趣加入么，我的QQ55763</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3279618,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3279618,&#39;Bury&#39;,this)">反对(8)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3299244" class="layer">#52楼</a><a name="3299244" id="comment_anchor_3299244"></a>  <span class="comment_date">2015-11-04 22:02</span> <a id="a_comment_author_3299244" href="http://www.cnblogs.com/njl041x/" target="_blank">njl_041x</a> <a href="http://msg.cnblogs.com/send/njl_041x" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3299244" class="blog_comment_body">"ASP.NET Identity使用Entity Framework Code First来自动创建数据库架构"<br>请教博主，我不想使用EF自动创建的数据库架构，我有自己设计的数据库结构，请问如何使用ASP.NET Identity？？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3299244,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3299244,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3299244_avatar" style="display:none;">http://pic.cnblogs.com/face/240878/20151016115127.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3299248" class="layer">#53楼</a><a name="3299248" id="comment_anchor_3299248"></a>  <span class="comment_date">2015-11-04 22:07</span> <a id="a_comment_author_3299248" href="http://www.cnblogs.com/njl041x/" target="_blank">njl_041x</a> <a href="http://msg.cnblogs.com/send/njl_041x" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3299248" class="blog_comment_body">在IdentityConfig 中有一个app.CreatePerOwinContext&lt;AppIdentityDbContext&gt;(AppIdentityDbContext.Create); 这个是EF用来自动创建数据库架构的上下文吗？我使用的是DB First模式，这个必须配置吗？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3299248,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3299248,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3299248_avatar" style="display:none;">http://pic.cnblogs.com/face/240878/20151016115127.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3321445" class="layer">#54楼</a><a name="3321445" id="comment_anchor_3321445"></a>  <span class="comment_date">2015-12-05 23:36</span> <a id="a_comment_author_3321445" href="http://www.cnblogs.com/micenote/" target="_blank">唐老鸭</a> <a href="http://msg.cnblogs.com/send/%E5%94%90%E8%80%81%E9%B8%AD" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3321445" class="blog_comment_body">示例代码数据怎么部署的？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3321445,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3321445,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3333552" class="layer">#55楼</a><a name="3333552" id="comment_anchor_3333552"></a>  <span class="comment_date">2015-12-24 12:53</span> <a id="a_comment_author_3333552" href="http://home.cnblogs.com/u/781193/" target="_blank">lzlamdin</a> <a href="http://msg.cnblogs.com/send/lzlamdin" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3333552" class="blog_comment_body">楼主你好，刚开始学习MVC，您的博客对我帮助很大，能提供一下源码下载地址吗？谢谢~~</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3333552,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3333552,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3335184" class="layer">#56楼</a><a name="3335184" id="comment_anchor_3335184"></a>  <span class="comment_date">2015-12-26 14:41</span> <a id="a_comment_author_3335184" href="http://www.cnblogs.com/Wddpct/" target="_blank">白细胞</a> <a href="http://msg.cnblogs.com/send/%E7%99%BD%E7%BB%86%E8%83%9E" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3335184" class="blog_comment_body">楼主好，请问identity的cookie默认保持多久呢</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3335184,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3335184,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3335184_avatar" style="display:none;">http://pic.cnblogs.com/face/647983/20151216145018.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3346955" class="layer">#57楼</a><a name="3346955" id="comment_anchor_3346955"></a>  <span class="comment_date">2016-01-13 15:32</span> <a id="a_comment_author_3346955" href="http://home.cnblogs.com/u/665020/" target="_blank">周岩</a> <a href="http://msg.cnblogs.com/send/%E5%91%A8%E5%B2%A9" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3346955" class="blog_comment_body"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3299244" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3299244);">@</a>
njl_041x<br>你用MVC5使用ASP.NET IDENTITY的时候会自动生成五张表，关于注册用户和角色那一块的。其实和你自己的数据库是不冲突的。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3346955,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3346955,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3363520" class="layer">#58楼</a><a name="3363520" id="comment_anchor_3363520"></a>  <span class="comment_date">2016-02-19 11:02</span> <a id="a_comment_author_3363520" href="http://www.cnblogs.com/zbo/" target="_blank">风也无奈</a> <a href="http://msg.cnblogs.com/send/%E9%A3%8E%E4%B9%9F%E6%97%A0%E5%A5%88" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3363520" class="blog_comment_body">“/”应用程序中的服务器错误。<br><br>找不到对象“dbo.AspNetUsers”，因为它不存在或者您没有所需的权限。<br><br>说明: 执行当前 Web 请求期间，出现未经处理的异常。请检查堆栈跟踪信息，以了解有关该错误以及代码中导致错误的出处的详细信息。 <br><br>异常详细信息: System.Data.SqlClient.SqlException: 找不到对象“dbo.AspNetUsers”，因为它不存在或者您没有所需的权限。<br><br>Demo运行不能登录呀，提示如上信息，按理说应该会自动创建库和表呀，我已经改成如下：<br>public class IdentityDbInit : CreateDatabaseIfNotExists&lt;AppIdentityDbContext&gt;<br>    {<br>  <br>    }<br>Web.config也更改为&lt;connectionStrings&gt;<br>    &lt;add name="IdentityDb" providerName="System.Data.SqlClient" connectionString="server=127.0.0.1;database=IdentityDb;User Id=sa;Password=123456;"  /&gt;<br>  &lt;/connectionStrings&gt;<br><br>请帮忙看一下怎么回事</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3363520,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3363520,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3363520_avatar" style="display:none;">http://pic.cnblogs.com/face/u26045.jpg</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3396671" class="layer">#59楼</a><a name="3396671" id="comment_anchor_3396671"></a>  <span class="comment_date">2016-03-31 13:01</span> <a id="a_comment_author_3396671" href="http://home.cnblogs.com/u/676534/" target="_blank">夏日萤火</a> <a href="http://msg.cnblogs.com/send/%E5%A4%8F%E6%97%A5%E8%90%A4%E7%81%AB" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3396671" class="blog_comment_body"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3279618" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3279618);">@</a>
phbrother003<br>不小心点错了，抱歉。怎么取消呢？</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3396671,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3396671,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3509087" class="layer">#60楼</a><a name="3509087" id="comment_anchor_3509087"></a>  <span class="comment_date">2016-09-12 20:59</span> <a id="a_comment_author_3509087" href="http://www.cnblogs.com/kid1412/" target="_blank">kid1412</a> <a href="http://msg.cnblogs.com/send/kid1412" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3509087" class="blog_comment_body">写得真心好,受益良多,多谢博主!</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3509087,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3509087,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3520846" class="layer">#61楼</a><a name="3520846" id="comment_anchor_3520846"></a>  <span class="comment_date">2016-09-27 19:34</span> <a id="a_comment_author_3520846" href="http://www.cnblogs.com/dudeping/" target="_blank">浪里淘沙</a> <a href="http://msg.cnblogs.com/send/%E6%B5%AA%E9%87%8C%E6%B7%98%E6%B2%99" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3520846" class="blog_comment_body"><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/902133-20160927193327016-1308558926.png" alt="" border="0" "=""><br>楼主帮忙看一下这个启动项的错误，谢谢了。</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3520846,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3520846,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3520846_avatar" style="display:none;">http://pic.cnblogs.com/face/902133/20160303143758.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3654932" class="layer">#62楼</a><a name="3654932" id="comment_anchor_3654932"></a>  <span class="comment_date">2017-03-29 17:59</span> <a id="a_comment_author_3654932" href="http://www.cnblogs.com/mazhiyuan/" target="_blank">愚</a> <a href="http://msg.cnblogs.com/send/%E6%84%9A" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3654932" class="blog_comment_body">我第一次真心赞别人的文章. 你的写的真真好</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3654932,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3654932,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702292" class="layer">#63楼</a><a name="3702292" id="comment_anchor_3702292"></a>  <span class="comment_date">2017-05-27 14:39</span> <a id="a_comment_author_3702292" href="http://home.cnblogs.com/u/1058641/" target="_blank">蝈蝈520</a> <a href="http://msg.cnblogs.com/send/%E8%9D%88%E8%9D%88520" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3702292" class="blog_comment_body"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3363520" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3363520);">@</a>
风也无奈<br>你解决没！</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3702292,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3702292,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702295" class="layer">#64楼</a><a name="3702295" id="comment_anchor_3702295"></a>  <span class="comment_date">2017-05-27 14:40</span> <a id="a_comment_author_3702295" href="http://home.cnblogs.com/u/1058641/" target="_blank">蝈蝈520</a> <a href="http://msg.cnblogs.com/send/%E8%9D%88%E8%9D%88520" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3702295" class="blog_comment_body">“/”应用程序中的服务器错误。<br><br>找不到对象“dbo.AspNetUsers”，因为它不存在或者您没有所需的权限。<br><br>说明: 执行当前 Web 请求期间，出现未经处理的异常。请检查堆栈跟踪信息，以了解有关该错误以及代码中导致错误的出处的详细信息。 <br><br>异常详细信息: System.Data.SqlClient.SqlException: 找不到对象“dbo.AspNetUsers”，因为它不存在或者您没有所需的权限。<br><br>Demo运行不能登录呀，提示如上信息，按理说应该会自动创建库和表呀，我已经改成如下：<br>public class IdentityDbInit : CreateDatabaseIfNotExists&lt;AppIdentityDbContext&gt;<br>{<br><br>}<br>Web.config也更改为&lt;connectionStrings&gt;<br>&lt;add name="IdentityDb" providerName="System.Data.SqlClient" connectionString="server=127.0.0.1;database=IdentityDb;User Id=sa;Password=123456;" /&gt;<br>&lt;/connectionStrings&gt;</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3702295,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3702295,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702311" class="layer">#65楼</a><a name="3702311" id="comment_anchor_3702311"></a>[<span class="louzhu">楼主</span>]  <span class="comment_date">2017-05-27 14:53</span> <a id="a_comment_author_3702311" href="http://www.cnblogs.com/OceanEyes/" target="_blank">木宛城主</a> <a href="http://msg.cnblogs.com/send/%E6%9C%A8%E5%AE%9B%E5%9F%8E%E4%B8%BB" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3702311" class="blog_comment_body"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702295" title="查看所回复的评论" onclick="commentManager.renderComments(0,50,3702295);">@</a>
蝈蝈520<br>Demo的的迁移策略是针对第三篇文章的，你试试：<br>public class AppIdentityDbContext : IdentityDbContext&lt;AppUser&gt;<br>   {<br>       public AppIdentityDbContext() : base("IdentityDb")<br>       {<br>       }<br> <br>       static AppIdentityDbContext()<br>       {<br>           Database.SetInitializer&lt;AppIdentityDbContext&gt;(new IdentityDbInit());<br>       }<br> <br>       public static AppIdentityDbContext Create()<br>       {<br>           return new AppIdentityDbContext();<br>       }<br>   }<br>   public class IdentityDbInit : DropCreateDatabaseIfModelChanges&lt;AppIdentityDbContext&gt;<br>   {<br>       protected override void Seed(AppIdentityDbContext context)<br>       {<br>           PerformInitialSetup(context);<br>           base.Seed(context);<br>       }<br>       public void PerformInitialSetup(AppIdentityDbContext context)<br>       {<br>           //初始化<br>       }<br>   }<br>时间太久，我也记不得了</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3702311,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3702311,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3702311_avatar" style="display:none;">http://pic.cnblogs.com/face/299214/20150329043854.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3711478" class="layer">#66楼</a><a name="3711478" id="comment_anchor_3711478"></a>  <span class="comment_date">2017-06-10 15:09</span> <a id="a_comment_author_3711478" href="http://www.cnblogs.com/kennyliu/" target="_blank">科刘</a> <a href="http://msg.cnblogs.com/send/%E7%A7%91%E5%88%98" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3711478" class="blog_comment_body">代码运行失败，数据库没有初始化的同学看这里：<br><br>在  AppIdentityDbContext 里把 public class IdentityDbInit:NullDatabaseInitializer&lt;AppIdentityDbContext&gt; 替换为：<br><div class="cnblogs_Highlighter sh-gutter"><div><div id="highlighter_762113" class="syntaxhighlighter  csharp"><div class="toolbar"><span><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1">44</div><div class="line number45 index44 alt2">45</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="csharp keyword">public</code> <code class="csharp keyword">class</code> <code class="csharp plain">IdentityDbInit : DropCreateDatabaseIfModelChanges&lt;AppIdentityDbContext&gt;</code></div><div class="line number2 index1 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number3 index2 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">protected</code> <code class="csharp keyword">override</code> <code class="csharp keyword">void</code> <code class="csharp plain">Seed(AppIdentityDbContext context)</code></div><div class="line number4 index3 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number5 index4 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">PerformInitialSetup(context);</code></div><div class="line number6 index5 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">base</code><code class="csharp plain">.Seed(context);</code></div><div class="line number7 index6 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number8 index7 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">public</code> <code class="csharp keyword">void</code> <code class="csharp plain">PerformInitialSetup(AppIdentityDbContext context)</code></div><div class="line number9 index8 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number10 index9 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp comments">//初始化</code></div><div class="line number11 index10 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">AppUserManager userManager = </code><code class="csharp keyword">new</code> <code class="csharp plain">AppUserManager(</code><code class="csharp keyword">new</code> <code class="csharp plain">UserStore&lt;AppUser&gt;(context));</code></div><div class="line number12 index11 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">AppRoleManager roleManager = </code><code class="csharp keyword">new</code> <code class="csharp plain">AppRoleManager(</code><code class="csharp keyword">new</code> <code class="csharp plain">RoleStore&lt;AppRole&gt;(context));</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">string</code> <code class="csharp plain">roleName = </code><code class="csharp string">"Administrator"</code><code class="csharp plain">;</code></div><div class="line number15 index14 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">string</code> <code class="csharp plain">userName = </code><code class="csharp string">"Admin"</code><code class="csharp plain">;</code></div><div class="line number16 index15 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">string</code> <code class="csharp plain">password = </code><code class="csharp string">"Password2015"</code><code class="csharp plain">;</code></div><div class="line number17 index16 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">string</code> <code class="csharp plain">email = </code><code class="csharp string">"admin@jkxy.com"</code><code class="csharp plain">;</code></div><div class="line number18 index17 alt1">&nbsp;</div><div class="line number19 index18 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">(!roleManager.RoleExists(roleName))</code></div><div class="line number20 index19 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number21 index20 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">roleManager.Create(</code><code class="csharp keyword">new</code> <code class="csharp plain">AppRole(roleName));</code></div><div class="line number22 index21 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">AppUser user = userManager.FindByName(userName);</code></div><div class="line number25 index24 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">(user == </code><code class="csharp keyword">null</code><code class="csharp plain">)</code></div><div class="line number26 index25 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number27 index26 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">userManager.Create(</code><code class="csharp keyword">new</code> <code class="csharp plain">AppUser { UserName = userName, Email = email },</code></div><div class="line number28 index27 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">password);</code></div><div class="line number29 index28 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">user = userManager.FindByName(userName);</code></div><div class="line number30 index29 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number31 index30 alt2">&nbsp;</div><div class="line number32 index31 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">(!userManager.IsInRole(user.Id, roleName))</code></div><div class="line number33 index32 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number34 index33 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">userManager.AddToRole(user.Id, roleName);</code></div><div class="line number35 index34 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number36 index35 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">foreach</code> <code class="csharp plain">(AppUser dbUser </code><code class="csharp keyword">in</code> <code class="csharp plain">userManager.Users)</code></div><div class="line number37 index36 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number38 index37 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp keyword">if</code> <code class="csharp plain">(dbUser.Country == Countries.None)</code></div><div class="line number39 index38 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">{</code></div><div class="line number40 index39 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">dbUser.SetCountryFromCity(dbUser.City);</code></div><div class="line number41 index40 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number42 index41 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number43 index42 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">context.SaveChanges();</code></div><div class="line number44 index43 alt1"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div><div class="line number45 index44 alt2"><code class="csharp spaces">&nbsp;&nbsp;&nbsp;</code><code class="csharp plain">}</code></div></div></td></tr></tbody></table></div></div></div></div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3711478,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3711478,&#39;Bury&#39;,this)">反对(0)</a></div><span id="comment_3711478_avatar" style="display:none;">http://pic.cnblogs.com/face/435748/20140424150702.png</span>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3725144" class="layer">#67楼</a><a name="3725144" id="comment_anchor_3725144"></a>  <span class="comment_date">2017-06-29 10:47</span> <a id="a_comment_author_3725144" href="http://home.cnblogs.com/u/586210/" target="_blank">BsaGyy</a> <a href="http://msg.cnblogs.com/send/BsaGyy" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3725144" class="blog_comment_body">为什么我照这么改了还是不能初始化数据库，崩溃了</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3725144,&#39;Digg&#39;,this)">支持(1)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3725144,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	
		<div class="feedbackItem">
			<div class="feedbackListSubtitle">
				<div class="feedbackManage">
					&nbsp;&nbsp;<span class="comment_actions"></span>
				</div>
				<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3725156" class="layer">#68楼</a><a name="3725156" id="comment_anchor_3725156"></a><span id="comment-maxId" style="display:none;">3725156</span><span id="comment-maxDate" style="display:none;">2017/6/29 10:52:27</span>  <span class="comment_date">2017-06-29 10:52</span> <a id="a_comment_author_3725156" href="http://home.cnblogs.com/u/586210/" target="_blank">BsaGyy</a> <a href="http://msg.cnblogs.com/send/BsaGyy" title="发送站内短消息" class="sendMsg2This">&nbsp;</a>
			</div>
			<div class="feedbackCon">
				<div id="comment_body_3725156" class="blog_comment_body">原来是迁移文件搞得鬼，虽然不懂原理，但是把迁移文件夹删除之后一切都好了</div><div class="comment_vote"><a href="javascript:void(0);" class="comment_digg" onclick="return voteComment(3725156,&#39;Digg&#39;,this)">支持(0)</a><a href="javascript:void(0);" class="comment_bury" onclick="return voteComment(3725156,&#39;Bury&#39;,this)">反对(0)</a></div>
			</div>
		</div>
	<div id="comments_pager_bottom"><div class="pager"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#!comments" onclick="commentManager.renderComments(1,50);return false;">&lt; Prev</a><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#!comments" onclick="commentManager.renderComments(1,50);return false;">1</a><span class="current">2</span></div></div></div><script type="text/javascript">var commentManager = new blogCommentManager();commentManager.renderComments(0);</script>
<div id="comment_form" class="commentform">
<a name="commentform"></a>
<div id="divCommentShow"></div>
<div id="comment_nav"><span id="span_refresh_tips"></span><a href="javascript:void(0);" onclick="return RefreshCommentList();" id="lnk_RefreshComments" runat="server" clientidmode="Static">刷新评论</a><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#" onclick="return RefreshPage();">刷新页面</a><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#top">返回顶部</a></div>
<div id="comment_form_container"><div class="login_tips">注册用户登录后才能发表评论，请 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return login(&#39;commentform&#39;);">登录</a> 或 <a rel="nofollow" href="javascript:void(0);" class="underline" onclick="return register();">注册</a>，<a href="http://www.cnblogs.com/">访问</a>网站首页。</div></div>
<div class="ad_text_commentbox" id="ad_text_under_commentbox"></div>
<div id="ad_t2"><a href="http://www.ucancode.com/index.htm" target="_blank">【推荐】50万行VC++源码: 大型组态工控、电力仿真CAD与GIS源码库</a><br><a href="https://www.jiguang.cn/devservice?bky" target="_blank">【推荐】极光开发者服务平台，五大功能一站集齐</a><br><a href="https://dnspod.cloud.tencent.com/act/seckill?fromSource=gwzcw.410370.410370.410370" target="_blank">【推荐】腾讯云域名+云解析 限时折扣抓紧抢购</a><br><a href="http://click.aliyun.com/m/18488/" target="_blank">【推荐】阿里云“全民云计算”优惠升级</a><br><a href="https://cloud.tencent.com/developer/labs?fromSource=gwzcw.330910.330910.330910" target="_blank">【推荐】一小时搭建人工智能应用，让技术更容易入门</a><br></div>
<div id="opt_under_post"></div>
<div id="cnblogs_c1" class="c_ad_block"><a href="http://cn.udacity.com/mlnd/?utm_source=cnblogs&amp;utm_medium=banner&amp;utm_campaign=MLND06" target="_blank"><img width="300" height="250" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/24442-20170816053533459-1918329004.png" alt="Udacity08.15 - 08.22"></a></div>
<div id="under_post_news"><div class="itnews c_ad_block"><b>最新IT新闻</b>:<br> ·  <a href="http://news.cnblogs.com/n/576636/" target="_blank">京东28元划痕传奇布：一抹去除汽车划痕</a><br> ·  <a href="http://news.cnblogs.com/n/576635/" target="_blank">比太阳能更稳的定发电技术：日本秀洋流黑科技</a><br> ·  <a href="http://news.cnblogs.com/n/576634/" target="_blank">西安女子获赠支付宝空白机票 目的地随便填</a><br> ·  <a href="http://news.cnblogs.com/n/576633/" target="_blank">索尼PlayStation官方推特被黑 结果出人意外</a><br> ·  <a href="http://news.cnblogs.com/n/576632/" target="_blank">丝般顺滑！安卓8.0正式版新功能体验：智能、人性化</a><br>» <a href="http://news.cnblogs.com/" title="IT新闻" target="_blank">更多新闻...</a></div></div>
<div id="cnblogs_c2" class="c_ad_block"><a href="https://www.jiguang.cn/devservice?source=bky&amp;hmsr=%E5%8D%9A%E5%AE%A2%E5%9B%AD&amp;hmpl=&amp;hmcu=&amp;hmkw=&amp;hmci=" target="_blank"><img width="468" height="60" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/24442-20170727100914671-839522651.gif" alt="极光0801"></a></div>
<div id="under_post_kb"><div class="itnews c_ad_block" id="kb_block"><b>最新知识库文章</b>:<br><div id="kb_recent"> ·  <a href="http://kb.cnblogs.com/page/575829/" target="_blank">做到这一点，你也可以成为优秀的程序员</a><br> ·  <a href="http://kb.cnblogs.com/page/566880/" target="_blank">写给立志做码农的大学生</a><br> ·  <a href="http://kb.cnblogs.com/page/569057/" target="_blank">架构腐化之谜</a><br> ·  <a href="http://kb.cnblogs.com/page/572854/" target="_blank">学会思考，而不只是编程</a><br> ·  <a href="http://kb.cnblogs.com/page/574767/" target="_blank">编写Shell脚本的最佳实践</a><br></div>» <a href="http://kb.cnblogs.com/" target="_blank">更多知识库文章...</a></div></div>
<div id="HistoryToday" class="c_ad_block"></div>
<script type="text/javascript">
    fixPostBody();
    setTimeout(function () { incrementViewCount(cb_entryId); }, 50);
    deliverAdT2();
    deliverAdC1();
    deliverAdC2();    
    loadNewsAndKb();
    loadBlogSignature();
    LoadPostInfoBlock(cb_blogId, cb_entryId, cb_blogApp, cb_blogUserGuid);
    GetPrevNextPost(cb_entryId, cb_blogId, cb_entryCreatedDate);
    loadOptUnderPost();
    GetHistoryToday(cb_blogId, cb_blogApp, cb_entryCreatedDate);   
</script>
</div>


	</div><!--end: forFlow -->
	</div><!--end: mainContent 主体内容容器-->

	<div id="sideBar">
		<div id="sideBarMain">
			
<!--done-->
<div class="newsItem">
<h3 class="catListTitle">公告</h3>
	<div id="blog-news"><p>微信公众号</p>
<img width="200px" height="200px" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/o_qrcode_for_gh_455306acb3af_430.jpg">


<h3 style="background-color: #3E6D8E;
border-bottom: 2px solid #F90;
color: white;
font-size: 105%;
margin: 15px 0 5px;
padding: 2px 5px;
cursor: pointer;">About Me</h3>
<p><img src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/o_MVP.png" alt="">&nbsp;</p>
<p><br>
</p>
C# &amp; .NET交流群：
<a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=60001c3d8e382464db3891e0ab5c132695c1ee58c0dc8092852db6073d2c790b"><img border="0" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/group.png" alt=".NET交流1（.NET）" title=".NET交流1（.NET）"></a>
<br>
SharePoint交流群：
<a target="_blank" href="http://shang.qq.com/wpa/qunwpa?idkey=4fd3826e28d62883d12382cbf90bb989a7799d2b36366f34c6b4590f96d4dbed"><img border="0" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/group.png" alt="SharePoint 2013入门与提高" title="SharePoint 2013入门与提高"></a><div id="profile_block">昵称：<a href="http://home.cnblogs.com/u/OceanEyes/">木宛城主</a><br>园龄：<a href="http://home.cnblogs.com/u/OceanEyes/" title="入园时间：2011-05-10">6年3个月</a><br>荣誉：<a href="http://www.cnblogs.com/expert/">推荐博客</a><br>粉丝：<a href="http://home.cnblogs.com/u/OceanEyes/followers/">1454</a><br>关注：<a href="http://home.cnblogs.com/u/OceanEyes/followees/">0</a><div id="p_b_follow"><a href="javascript:void(0);" onclick="follow(&#39;7d9cc6a0-df7a-e011-a53f-842b2b196315&#39;)">+加关注</a></div></div></div><script type="text/javascript">loadBlogNews();</script>
</div>

			<div id="calendar"><div id="blog-calendar" style="display:none"></div><script type="text/javascript">loadBlogDefaultCalendar();</script></div>
			
			<div id="leftcontentcontainer">
				<div id="blog-sidecolumn"><div id="sidebar_search" class="sidebar-block"></div><div id="sidebar_recentposts" class="sidebar-block">
<div class="catListEssay">
<h3 class="catListTitle">最新随笔</h3>
<ul>
<li><a href="http://www.cnblogs.com/OceanEyes/p/log_strategy.html">1. Unity应用架构设计(13)——日志组件的实施</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/aop_in_action.html">2. Unity应用架构设计(12)——AOP思想的实践</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/implement_a_interpreter.html">3. 从编译原理看一个解释器的实现</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/building_service_layer.html">4. Unity应用架构设计(11)——一个网络层的构建</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_multithreading_part2.html">5. Unity应用架构设计(10)——绕不开的协程和多线程（Part 2）</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_threading.html">6. Unity应用架构设计(10)——绕不开的协程和多线程（Part 1）</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/thinking_in_repository_pattern.html">7. Unity应用架构设计(9)——构建统一的 Repository</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/using_service_locator.html">8. Unity应用架构设计(8)——使用ServiceLocator实现对象的注入</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/factory_pattern.html">9. Unity应用架构设计(7)——IoC工厂理念先行</a></li><li><a href="http://www.cnblogs.com/OceanEyes/p/setting_up_observablelist.html">10. Unity应用架构设计(6)——设计动态数据集合ObservableList</a></li>
</ul>
</div>
</div><div id="sidebar_categories">
<div class="catListPostCategory">
<h3 class="catListTitle">随笔分类<span style="font-size:11px;font-weight:normal">(198)</span></h3>

<ul>

<li><a id="CatList_LinkList_0_Link_0" href="http://www.cnblogs.com/OceanEyes/category/839970.html">.NET Core(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_1" href="http://www.cnblogs.com/OceanEyes/category/300842.html">Algorithms(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_2" href="http://www.cnblogs.com/OceanEyes/category/374646.html">ASP.NET(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_3" href="http://www.cnblogs.com/OceanEyes/category/404304.html">ASP.NET Essential(4)</a> </li>

<li><a id="CatList_LinkList_0_Link_4" href="http://www.cnblogs.com/OceanEyes/category/393525.html">ASP.NET MVC(12)</a> </li>

<li><a id="CatList_LinkList_0_Link_5" href="http://www.cnblogs.com/OceanEyes/category/696137.html">ASP.NET MVC 随想录(6)</a> </li>

<li><a id="CatList_LinkList_0_Link_6" href="http://www.cnblogs.com/OceanEyes/category/670354.html">Bootstrap(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_7" href="http://www.cnblogs.com/OceanEyes/category/392686.html">CLR via C# 技术内幕(5)</a> </li>

<li><a id="CatList_LinkList_0_Link_8" href="http://www.cnblogs.com/OceanEyes/category/567607.html">Disaster Recovery(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_9" href="http://www.cnblogs.com/OceanEyes/category/659690.html">Hyper-V(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_10" href="http://www.cnblogs.com/OceanEyes/category/382251.html">JavaScript</a> </li>

<li><a id="CatList_LinkList_0_Link_11" href="http://www.cnblogs.com/OceanEyes/category/400473.html">Lucene.Net(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_12" href="http://www.cnblogs.com/OceanEyes/category/466830.html">PowerShell For SharePoint(10)</a> </li>

<li><a id="CatList_LinkList_0_Link_13" href="http://www.cnblogs.com/OceanEyes/category/780275.html">Scrum(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_14" href="http://www.cnblogs.com/OceanEyes/category/582195.html">SharePoint 2013 Step by Step(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_15" href="http://www.cnblogs.com/OceanEyes/category/471158.html">SharePoint In Action(40)</a> </li>

<li><a id="CatList_LinkList_0_Link_16" href="http://www.cnblogs.com/OceanEyes/category/507122.html">SharePoint 项目实战(18)</a> </li>

<li><a id="CatList_LinkList_0_Link_17" href="http://www.cnblogs.com/OceanEyes/category/381976.html">SQL SERVER T-TQL(2)</a> </li>

<li><a id="CatList_LinkList_0_Link_18" href="http://www.cnblogs.com/OceanEyes/category/352178.html">Thinking In Design Pattern(9)</a> </li>

<li><a id="CatList_LinkList_0_Link_19" href="http://www.cnblogs.com/OceanEyes/category/827748.html">Unity 3D(16)</a> </li>

<li><a id="CatList_LinkList_0_Link_20" href="http://www.cnblogs.com/OceanEyes/category/972425.html">Unity应用架构设计(16)</a> </li>

<li><a id="CatList_LinkList_0_Link_21" href="http://www.cnblogs.com/OceanEyes/category/971418.html">VR SPACE</a> </li>

<li><a id="CatList_LinkList_0_Link_22" href="http://www.cnblogs.com/OceanEyes/category/613125.html">跟我学SharePoint 2013视频培训课程(15)</a> </li>

<li><a id="CatList_LinkList_0_Link_23" href="http://www.cnblogs.com/OceanEyes/category/353453.html">架构思想(10)</a> </li>

<li><a id="CatList_LinkList_0_Link_24" href="http://www.cnblogs.com/OceanEyes/category/350874.html">木宛城(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_25" href="http://www.cnblogs.com/OceanEyes/category/385667.html">网络编程(1)</a> </li>

<li><a id="CatList_LinkList_0_Link_26" href="http://www.cnblogs.com/OceanEyes/category/401324.html">项目管理(3)</a> </li>

<li><a id="CatList_LinkList_0_Link_27" href="http://www.cnblogs.com/OceanEyes/category/353286.html">杂谈(7)</a> </li>

</ul>

</div>

<div class="catListPostArchive">
<h3 class="catListTitle">随笔档案<span style="font-size:11px;font-weight:normal">(152)</span></h3>

<ul>

<li><a id="CatList_LinkList_1_Link_0" href="http://www.cnblogs.com/OceanEyes/archive/2017/07.html">2017年7月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_1" href="http://www.cnblogs.com/OceanEyes/archive/2017/06.html">2017年6月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_2" href="http://www.cnblogs.com/OceanEyes/archive/2017/05.html">2017年5月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_3" href="http://www.cnblogs.com/OceanEyes/archive/2017/03.html">2017年3月 (11)</a> </li>

<li><a id="CatList_LinkList_1_Link_4" href="http://www.cnblogs.com/OceanEyes/archive/2016/06.html">2016年6月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_5" href="http://www.cnblogs.com/OceanEyes/archive/2016/05.html">2016年5月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_6" href="http://www.cnblogs.com/OceanEyes/archive/2016/01.html">2016年1月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_7" href="http://www.cnblogs.com/OceanEyes/archive/2015/09.html">2015年9月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_8" href="http://www.cnblogs.com/OceanEyes/archive/2015/08.html">2015年8月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_9" href="http://www.cnblogs.com/OceanEyes/archive/2015/07.html">2015年7月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_10" href="http://www.cnblogs.com/OceanEyes/archive/2015/06.html">2015年6月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_11" href="http://www.cnblogs.com/OceanEyes/archive/2015/05.html">2015年5月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_12" href="http://www.cnblogs.com/OceanEyes/archive/2015/04.html">2015年4月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_13" href="http://www.cnblogs.com/OceanEyes/archive/2015/03.html">2015年3月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_14" href="http://www.cnblogs.com/OceanEyes/archive/2015/02.html">2015年2月 (6)</a> </li>

<li><a id="CatList_LinkList_1_Link_15" href="http://www.cnblogs.com/OceanEyes/archive/2015/01.html">2015年1月 (13)</a> </li>

<li><a id="CatList_LinkList_1_Link_16" href="http://www.cnblogs.com/OceanEyes/archive/2014/09.html">2014年9月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_17" href="http://www.cnblogs.com/OceanEyes/archive/2014/08.html">2014年8月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_18" href="http://www.cnblogs.com/OceanEyes/archive/2014/07.html">2014年7月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_19" href="http://www.cnblogs.com/OceanEyes/archive/2014/06.html">2014年6月 (7)</a> </li>

<li><a id="CatList_LinkList_1_Link_20" href="http://www.cnblogs.com/OceanEyes/archive/2014/05.html">2014年5月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_21" href="http://www.cnblogs.com/OceanEyes/archive/2014/04.html">2014年4月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_22" href="http://www.cnblogs.com/OceanEyes/archive/2014/03.html">2014年3月 (9)</a> </li>

<li><a id="CatList_LinkList_1_Link_23" href="http://www.cnblogs.com/OceanEyes/archive/2014/02.html">2014年2月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_24" href="http://www.cnblogs.com/OceanEyes/archive/2014/01.html">2014年1月 (5)</a> </li>

<li><a id="CatList_LinkList_1_Link_25" href="http://www.cnblogs.com/OceanEyes/archive/2013/12.html">2013年12月 (5)</a> </li>

<li><a id="CatList_LinkList_1_Link_26" href="http://www.cnblogs.com/OceanEyes/archive/2013/11.html">2013年11月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_27" href="http://www.cnblogs.com/OceanEyes/archive/2013/10.html">2013年10月 (5)</a> </li>

<li><a id="CatList_LinkList_1_Link_28" href="http://www.cnblogs.com/OceanEyes/archive/2013/09.html">2013年9月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_29" href="http://www.cnblogs.com/OceanEyes/archive/2013/08.html">2013年8月 (3)</a> </li>

<li><a id="CatList_LinkList_1_Link_30" href="http://www.cnblogs.com/OceanEyes/archive/2013/07.html">2013年7月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_31" href="http://www.cnblogs.com/OceanEyes/archive/2013/06.html">2013年6月 (4)</a> </li>

<li><a id="CatList_LinkList_1_Link_32" href="http://www.cnblogs.com/OceanEyes/archive/2013/04.html">2013年4月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_33" href="http://www.cnblogs.com/OceanEyes/archive/2013/03.html">2013年3月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_34" href="http://www.cnblogs.com/OceanEyes/archive/2012/12.html">2012年12月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_35" href="http://www.cnblogs.com/OceanEyes/archive/2012/11.html">2012年11月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_36" href="http://www.cnblogs.com/OceanEyes/archive/2012/10.html">2012年10月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_37" href="http://www.cnblogs.com/OceanEyes/archive/2012/09.html">2012年9月 (4)</a> </li>

<li><a id="CatList_LinkList_1_Link_38" href="http://www.cnblogs.com/OceanEyes/archive/2012/08.html">2012年8月 (7)</a> </li>

<li><a id="CatList_LinkList_1_Link_39" href="http://www.cnblogs.com/OceanEyes/archive/2012/07.html">2012年7月 (9)</a> </li>

<li><a id="CatList_LinkList_1_Link_40" href="http://www.cnblogs.com/OceanEyes/archive/2012/06.html">2012年6月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_41" href="http://www.cnblogs.com/OceanEyes/archive/2012/05.html">2012年5月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_42" href="http://www.cnblogs.com/OceanEyes/archive/2012/04.html">2012年4月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_43" href="http://www.cnblogs.com/OceanEyes/archive/2012/03.html">2012年3月 (2)</a> </li>

<li><a id="CatList_LinkList_1_Link_44" href="http://www.cnblogs.com/OceanEyes/archive/2012/02.html">2012年2月 (4)</a> </li>

<li><a id="CatList_LinkList_1_Link_45" href="http://www.cnblogs.com/OceanEyes/archive/2012/01.html">2012年1月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_46" href="http://www.cnblogs.com/OceanEyes/archive/2011/10.html">2011年10月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_47" href="http://www.cnblogs.com/OceanEyes/archive/2011/07.html">2011年7月 (1)</a> </li>

<li><a id="CatList_LinkList_1_Link_48" href="http://www.cnblogs.com/OceanEyes/archive/2011/05.html">2011年5月 (2)</a> </li>

</ul>

</div>

</div><div id="sidebar_recentcomments" class="sidebar-block"><div id="recent_comments_wrap">
<div class="catListComment">
<h3 class="catListTitle">最新评论</h3>
	<div id="RecentCommentsBlock"><ul>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/asp-net-identity-claim-based-authorization.html#3759494">1. Re:ASP.NET MVC 随想录——  使用ASP.NET Identity实现基于声明的授权，高级篇</a></li>
        <li class="recent_comment_body">喜欢楼主的写作风格，特别喜欢最后那一句话。。。</li>
        <li class="recent_comment_author">--随心520</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/using-bootstrap-javascript-plugins.html#3752670">2. Re:ASP.NET MVC使用Bootstrap系列（4）——使用JavaScript插件</a></li>
        <li class="recent_comment_body">好文章</li>
        <li class="recent_comment_author">--墨暖</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/archive/2012/08/13/aspnetEssential-1.html#3741668">3. Re:ASP.NET那点不为人知的事（一）</a></li>
        <li class="recent_comment_body">请问楼主大牛还有邹老师的视频吗？网上好像找不到了</li>
        <li class="recent_comment_author">--又见阿郎</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/archive/2012/08/13/aspnetEssential-1.html#3730972">4. Re:ASP.NET那点不为人知的事（一）</a></li>
        <li class="recent_comment_body">为什么不管看多少遍，能记住的也就只有里面两三个方法？是因为我始终找不到场景使用吗？</li>
        <li class="recent_comment_author">--故乡的星空</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/get-started-with-bootstrap.html#3730142">5. Re:ASP.NET MVC使用Bootstrap系列（1）——开始使用Bootstrap</a></li>
        <li class="recent_comment_body">最新Bootstrap手册：<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html" target="_blank"></a></li>
        <li class="recent_comment_author">--武鸿达</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/creating-bootstrap-helpers.html#3729912">6. Re:ASP.NET MVC使用Bootstrap系列（5）——创建ASP.NET MVC Bootstrap Helpers</a></li>
        <li class="recent_comment_body">最新Bootstrap手册：<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html" target="_blank"></a></li>
        <li class="recent_comment_author">--武鸿达</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/using-bootstrap-components.html#3729636">7. Re:ASP.NET MVC使用Bootstrap系列（3）——使用Bootstrap 组件</a></li>
        <li class="recent_comment_body">最新Bootstrap手册：<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html" target="_blank"></a></li>
        <li class="recent_comment_author">--武鸿达</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/bootstrap-html-elements.html#3729588">8. Re:ASP.NET MVC使用Bootstrap系统（2）——使用Bootstrap CSS和HTML元素</a></li>
        <li class="recent_comment_body">最新Bootstrap手册：<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html" target="_blank"></a></li>
        <li class="recent_comment_author">--武鸿达</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/aop_in_action.html#3728768">9. Re:Unity应用架构设计(12)——AOP思想的实践</a></li>
        <li class="recent_comment_body">支持一下！</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/aop_in_action.html#3728559">10. Re:Unity应用架构设计(12)——AOP思想的实践</a></li>
        <li class="recent_comment_body">@Lemon丶说得好，受教了...</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/aop_in_action.html#3728558">11. Re:Unity应用架构设计(12)——AOP思想的实践</a></li>
        <li class="recent_comment_body">@木宛城主反射性能是一回事。另一方面，aop 是否支持拦截器管道链式调用，aop是否可以简便配置，以及能否和IoC友好的集成都是需要考虑的地方...</li>
        <li class="recent_comment_author">--Lemon丶</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/aop_in_action.html#3728477">12. Re:Unity应用架构设计(12)——AOP思想的实践</a></li>
        <li class="recent_comment_body">@Lemon丶好的。不过反射性能，仁者见仁智者见智吧，很多框架都是基于反射实现的。...</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/aop_in_action.html#3728474">13. Re:Unity应用架构设计(12)——AOP思想的实践</a></li>
        <li class="recent_comment_body">直接反射不是一个好的实践~<br>对于.net上的AOP ，最佳实践可以看我写的 <a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html" target="_blank"></a></li>
        <li class="recent_comment_author">--Lemon丶</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3725156">14. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">原来是迁移文件搞得鬼，虽然不懂原理，但是把迁移文件夹删除之后一切都好了</li>
        <li class="recent_comment_author">--BsaGyy</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3725144">15. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">为什么我照这么改了还是不能初始化数据库，崩溃了</li>
        <li class="recent_comment_author">--BsaGyy</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/implement_a_interpreter.html#3718773">16. Re:从编译原理看一个解释器的实现</a></li>
        <li class="recent_comment_body">直接使用Lua 就可以了啊！  在复杂的字符串表达式都是可以的</li>
        <li class="recent_comment_author">--游戏开发实验室</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/implement_a_interpreter.html#3717183">17. Re:从编译原理看一个解释器的实现</a></li>
        <li class="recent_comment_body">mark</li>
        <li class="recent_comment_author">--假程序猿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/implement_a_interpreter.html#3717105">18. Re:从编译原理看一个解释器的实现</a></li>
        <li class="recent_comment_body">牛 深入简出！</li>
        <li class="recent_comment_author">--Crazy_Yang</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/implement_a_interpreter.html#3717048">19. Re:从编译原理看一个解释器的实现</a></li>
        <li class="recent_comment_body">学习一下</li>
        <li class="recent_comment_author">--自由布鲁斯</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3711478">20. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">代码运行失败，数据库没有初始化的同学看这里：在 AppIdentityDbContext 里把 public class IdentityDbInit:NullDatabaseInitializer......</li>
        <li class="recent_comment_author">--科刘</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/asp-net-identity-claim-based-authorization.html#3710770">21. Re:ASP.NET MVC 随想录——  使用ASP.NET Identity实现基于声明的授权，高级篇</a></li>
        <li class="recent_comment_body">@偷得一日闲[Authorize(Roles = "BjStaff")]像这样肯定是写死了。我之前的一种实现方式是，有一个配置界面，配置用户和访问页面（Controller/Action）的关系。然后......</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/asp-net-identity-claim-based-authorization.html#3710488">22. Re:ASP.NET MVC 随想录——  使用ASP.NET Identity实现基于声明的授权，高级篇</a></li>
        <li class="recent_comment_body">@木宛城主，楼主，关于ASP.NET Identity，我想请教个我一直没有搞明白的问题：按照ASP.NET Identity的设计，Role是可以在运行期增删的，但是Role对Controller的......</li>
        <li class="recent_comment_author">--偷得一日闲</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/building_service_layer.html#3709867">23. Re:Unity应用架构设计(11)——一个网络层的构建</a></li>
        <li class="recent_comment_body">@马三小伙儿多谢支持...</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/building_service_layer.html#3709836">24. Re:Unity应用架构设计(11)——一个网络层的构建</a></li>
        <li class="recent_comment_body">支持一下~ 很不错~</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702311">25. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">@蝈蝈520Demo的的迁移策略是针对第三篇文章的，你试试：public class AppIdentityDbContext : IdentityDbContext { public......</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702295">26. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">“/”应用程序中的服务器错误。找不到对象“dbo.AspNetUsers”，因为它不存在或者您没有所需的权限。说明: 执行当前 Web 请求期间，出现未经处理的异常。请检查堆栈跟踪信息，以了解有关该错......</li>
        <li class="recent_comment_author">--蝈蝈520</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3702292">27. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">@风也无奈你解决没！...</li>
        <li class="recent_comment_author">--蝈蝈520</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_multithreading_part2.html#3701539">28. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 2）</a></li>
        <li class="recent_comment_body">@大程序猿小故事过奖了...</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_multithreading_part2.html#3701537">29. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 2）</a></li>
        <li class="recent_comment_body">大神</li>
        <li class="recent_comment_author">--大程序猿小故事</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_multithreading_part2.html#3701510">30. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 2）</a></li>
        <li class="recent_comment_body">@木宛城主 666，蛤蛤...</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_multithreading_part2.html#3701509">31. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 2）</a></li>
        <li class="recent_comment_body">@马三小伙儿可以的...</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_multithreading_part2.html#3701507">32. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 2）</a></li>
        <li class="recent_comment_body">学习一下，话说 “生产者-消费者模式” 这块用观察者模式来实现是不是可以呢？</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_threading.html#3700133">33. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 1）</a></li>
        <li class="recent_comment_body">@木宛城主哈哈 博主的文章很有质量，必看啊！...</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_threading.html#3700129">34. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 1）</a></li>
        <li class="recent_comment_body">@马三小伙儿多谢支持，每次都是你沙发：)...</li>
        <li class="recent_comment_author">--木宛城主</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/coroutine_vs_threading.html#3700127">35. Re:Unity应用架构设计(10)——绕不开的协程和多线程（Part 1）</a></li>
        <li class="recent_comment_body">非常不错~ 学习一下！</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/using-bootstrap-components.html#3692329">36. Re:ASP.NET MVC使用Bootstrap系列（3）——使用Bootstrap 组件</a></li>
        <li class="recent_comment_body">mark</li>
        <li class="recent_comment_author">--马甲线</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-apply-asp-net-identity-authentication.html#3686807">37. Re:ASP.NET MVC 随想录——探索ASP.NET Identity 身份验证和基于角色的授权，中级篇</a></li>
        <li class="recent_comment_body">Mark</li>
        <li class="recent_comment_author">--我_爱编程</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/archive/2012/08/27/linq-2.html#3681416">38. Re:Linq快速入门——Lambda表达式的前世今生</a></li>
        <li class="recent_comment_body">讲得很好，很具体，有事件的博客文章吗？</li>
        <li class="recent_comment_author">--XX的一些事一些情</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/factory_pattern.html#3656186">39. Re:Unity 3D Framework Designing(7)——IoC工厂理念先行</a></li>
        <li class="recent_comment_body">非常不错~ 支持一下~ 原来的公司也是用的依赖注入解耦的~</li>
        <li class="recent_comment_author">--马三小伙儿</li>
        <li class="recent_comment_title"><a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#3654932">40. Re:ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇</a></li>
        <li class="recent_comment_body">我第一次真心赞别人的文章. 你的写的真真好</li>
        <li class="recent_comment_author">--愚</li>
</ul>
</div>
</div>
</div></div></div><script type="text/javascript">loadBlogSideColumn();</script>
			</div>
			
		</div><!--end: sideBarMain -->
	</div><!--end: sideBar 侧边栏容器 -->
	<div class="clear"></div>
	</div><!--end: main -->
	<div class="clear"></div>
	<div id="footer">
		
<!--done-->
Copyright ©2017 木宛城主
	</div><!--end: footer -->
</div><!--end: home 自定义的最大容器 -->
<!--PageEndHtml Block Begin-->
<div align="center"><a href="http://www.inkjetdeals.info/brands/dell.html"><img border="0" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/9248710.png" alt="multifunction lasers"><br>访问人数</a></div>
<script language="javascript" type="text/javascript">
//生成目录索引列表
function GenerateContentList()
{
    var jquery_h3_list = $('#cnblogs_post_body h3');//如果你的章节标题不是h3,只需要将这里的h3换掉即可
    if(jquery_h3_list .length<=0){
       jquery_h3_list=$('#cnblogs_post_body h1');
     }
    if(jquery_h3_list.length>0)
    {
        var content = '<a name="_labelTop"></a>';
        content    += '<div id="navCategory">';
        content    += '<p style="font-size:18px"><b>阅读目录</b></p>';
        content    += '<ul>';
        for(var i =0;i<jquery_h3_list.length;i++)
        {
            var go_to_top = '<div style="text-align: right"><a href="#_labelTop">回到顶部</a><a name="_label' + i + '"></a></div>';
            $(jquery_h3_list[i]).before(go_to_top);
            var li_content = '<li><a href="#_label' + i + '">' + $(jquery_h3_list[i]).text() + '</a></li>';
            content += li_content;
        }
        content    += '</ul>';
        content    += '</div>';
        if($('#cnblogs_post_body').length != 0 )
        {
            $($('#cnblogs_post_body')[0]).prepend(content);
        }
    }    
}
GenerateContentList();
</script>
<!--PageEndHtml Block Begin-->


<div id="roll">
	<div title="回到顶部" id="roll_top">
	</div>
</div>
<!-- JiaThis Button BEGIN -->
<script type="text/javascript" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/jiathis_r.js.下载" charset="utf-8"></script><script src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/ckepop.js.下载" charset="utf-8"></script><script src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/ckecenterpop.js.下载" charset="utf-8"></script><script type="text/javascript" src="./ASP.NET MVC 随想录——开始使用ASP.NET Identity，初级篇 - 木宛城主 - 博客园_files/plugin.client.js.下载" charset="utf-8"></script>
<!-- JiaThis Button END -->
<style>

	#back-to-top{
		position:fixed;
		bottom:150px;
		right:74px;
	}
	#back-to-top a{
		text-align:center;
		text-decoration:none;
		color:#d1d1d1;
		display:block;
		width:80px;
		/*使用CSS3中的transition属性给跳转链接中的文字添加渐变效果*/
		-moz-transition:color 1s; 
		-webkit-transition:color 1s;
		-o-transition:color 1s;
	}
	#back-to-top a:hover{
		color:#979797;
	}
	#back-to-top a span{
		border-radius:6px;
		display:block;
		height:80px;
		width:80px;
		background:url(http://pic002.cnblogs.com/images/2011/36987/2011051823234124.png) no-repeat center center;
		margin-bottom:5px;
		-moz-transition:background 1s;
		-webkit-transition:background 1s;
		-o-transition:background 1s;
	}
	#back-to-top a:hover span{
		background:#979797 url(http://pic002.cnblogs.com/images/2011/36987/2011051823234124.png) no-repeat center center;
	}
</style>
<script type="text/javascript">
  $("head").prepend('');

      $(document).ready(function () {
          //首先将#back-to-top隐藏
          $("#back-to-top").hide();
          //当滚动条的位置处于距顶部100像素以下时，跳转链接出现，否则消失
          $(function () {
              $(window).scroll(function () {
                  if ($(window).scrollTop() > 100) {
                      $("#back-to-top").fadeIn(1500);
                  }
                  else {
                      $("#back-to-top").fadeOut(1500);
                  }
              });
              //当点击跳转链接后，回到页面顶部位置
              $("#back-to-top").click(function () {
                  $('body,html').animate({ scrollTop: 0 }, 1000);
                  return false;
              });
          });
      });
  </script>
<p id="back-to-top" style="display: block;">
	<a href="http://www.cnblogs.com/OceanEyes/p/thinking-in-asp-net-mvc-get-started-with-identity.html#top"><span></span></a>
</p>
<script type="text/javascript">
     function SetFavorite(){
	if( $("#div_digg").length < 1 ){
		setTimeout(SetFavorite, 1000); return;
	}

	$("<div style='padding-bottom: 5px'></div>")
		.append($("<span class='icon_favorite' style='padding-top: 2px; padding-bottom: 2px'></span>"))
		.append($("#green_channel_follow").clone(true).text("关注木宛城主")
				.removeAttr("id").css({ "font-weight": "bold", "padding-left": "5px" }))
		.prependTo("#div_digg");
}
 SetFavorite();
</script>
<!--PageEndHtml Block End-->

<!--uMVVM-->
<!--PageEndHtml Block End-->


</body></html>